null===module.parent&&(console.log("Run this test file with nodeunit:"),console.log("$ nodeunit test.js"));var clone=require("./"),util=require("util"),_=require("underscore");exports["clone string"]=function(e){e.expect(2);var t="foo";e.strictEqual(clone(t),t),t="",e.strictEqual(clone(t),t),e.done()},exports["clone number"]=function(e){e.expect(5);var t=0;e.strictEqual(clone(t),t),t=1,e.strictEqual(clone(t),t),t=-1e3,e.strictEqual(clone(t),t),t=3.1415927,e.strictEqual(clone(t),t),t=-3.1415927,e.strictEqual(clone(t),t),e.done()},exports["clone date"]=function(e){e.expect(3);var t=new Date,r=clone(t);e.ok(t instanceof Date),e.ok(r instanceof Date),e.equal(r.getTime(),t.getTime()),e.done()},exports["clone object"]=function(e){e.expect(2);var t={foo:{bar:"baz"}},r=clone(t);e.ok(_(t).isEqual(r),"underscore equal"),e.deepEqual(r,t),e.done()},exports["clone array"]=function(e){e.expect(2);var t=[{foo:"bar"},"baz"],r=clone(t);e.ok(_(t).isEqual(r),"underscore equal"),e.deepEqual(r,t),e.done()},exports["clone buffer"]=function(e){e.expect(1);var t=new Buffer("this is a test buffer"),r=clone(t);e.deepEqual(r,t),e.done()},exports["clone regexp"]=function(e){e.expect(5);var t=/abc123/gi,r=clone(t);e.deepEqual(r,t);var n=/a/g;e.ok(0===n.lastIndex),n.exec("123a456a"),e.ok(4===n.lastIndex);var i=clone(n);e.ok(i.global),e.ok(4===i.lastIndex),e.done()},exports["clone object containing array"]=function(e){e.expect(2);var t={arr1:[{a:"1234",b:"2345"}],arr2:[{c:"345",d:"456"}]},r=clone(t);e.ok(_(t).isEqual(r),"underscore equal"),e.deepEqual(r,t),e.done()},exports["clone object with circular reference"]=function(e){function o(e,t){return util.inspect(e,!0,null)===util.inspect(t,!0,null)}e.expect(8);var t=e.ok,r=[1,"foo",{hello:"bar"},function(){},!1,[2]],n=[r,2,3,4],i={b:n,c:r};i.loop=i,i.loop2=i,r.loop=r,r.aloop=i;var a=clone(i);t(i!=a),t(i.c!=a.c),t(a.c==a.b[0]),t(a.c.loop.loop.aloop==a),t(a.c[0]==i.c[0]),t(o(i,a)),a.c[0]=2,t(!o(i,a)),a.c="2",t(!o(i,a)),e.done()},exports.clonePrototype=function(e){e.expect(3);var t={a:"aaa",x:123,y:45.65},r=clone.clonePrototype(t);e.strictEqual(r.a,t.a),e.strictEqual(r.x,t.x),e.strictEqual(r.y,t.y),e.done()},exports.cloneWithinNewVMContext=function(e){e.expect(3);var t=require("vm"),r=t.createContext({clone:clone}),n="clone( {array: [1, 2, 3], date: new Date(), regex: /^foo$/ig} );",i=t.runInContext(n,r);e.ok(i.array instanceof Array),e.ok(i.date instanceof Date),e.ok(i.regex instanceof RegExp),e.done()},exports.cloneObjectWithNoConstructor=function(e){e.expect(3);var t=null,r={foo:"bar"};r.__proto__=t,e.ok("object"==typeof r),e.ok(null!==typeof r);var n=clone(r);e.ok(r.foo,n.foo),e.done()},exports["clone object with depth argument"]=function(e){e.expect(6);var t={foo:{bar:{baz:"qux"}}},r=clone(t,!1,1);e.deepEqual(r,t),e.notEqual(r,t),e.strictEqual(r.foo,t.foo),r=clone(t,!0,2),e.deepEqual(r,t),e.notEqual(r.foo,t.foo),e.strictEqual(r.foo.bar,t.foo.bar),e.done()},exports["maintain prototype chain in clones"]=function(e){function t(){}e.expect(1);var r=new t,n=clone(r);e.strictEqual(Object.getPrototypeOf(r),Object.getPrototypeOf(n)),e.done()},exports["parent prototype is overriden with prototype provided"]=function(e){function t(){}e.expect(1);var r=new t,n=clone(r,!0,1/0,null);e.strictEqual(n.__defineSetter__,void 0),e.done()},exports["clone object with null children"]=function(e){e.expect(1);var t={foo:{bar:null,baz:{qux:!1}}},r=clone(t);e.deepEqual(r,t),e.done()},exports["clone instance with getter"]=function(e){function t(){}e.expect(1),Object.defineProperty(t.prototype,"prop",{configurable:!0,enumerable:!0,get:function(){return"value"}});var r=new t,n=clone(r);e.strictEqual(n.prop,"value"),e.done()};