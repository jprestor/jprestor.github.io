var path=require("path"),test=require("tape"),resolve=require("../");test("mock",function(e){function r(e){return{basedir:path.resolve(e),isFile:function(e,r){r(null,Object.prototype.hasOwnProperty.call(t,path.resolve(e)))},readFile:function(e,r){r(null,t[path.resolve(e)])}}}e.plan(8);var t={};t[path.resolve("/foo/bar/baz.js")]="beep",resolve("./baz",r("/foo/bar"),function(t,r,n){return t?e.fail(t):(e.equal(r,path.resolve("/foo/bar/baz.js")),void e.equal(n,void 0))}),resolve("./baz.js",r("/foo/bar"),function(t,r,n){return t?e.fail(t):(e.equal(r,path.resolve("/foo/bar/baz.js")),void e.equal(n,void 0))}),resolve("baz",r("/foo/bar"),function(t,r){e.equal(t.message,"Cannot find module 'baz' from '"+path.resolve("/foo/bar")+"'"),e.equal(t.code,"MODULE_NOT_FOUND")}),resolve("../baz",r("/foo/bar"),function(t,r){e.equal(t.message,"Cannot find module '../baz' from '"+path.resolve("/foo/bar")+"'"),e.equal(t.code,"MODULE_NOT_FOUND")})}),test("mock from package",function(e){function r(e){return{basedir:path.resolve(e),isFile:function(e,r){r(null,Object.prototype.hasOwnProperty.call(t,e))},"package":{main:"bar"},readFile:function(e,r){r(null,t[e])}}}e.plan(8);var t={};t[path.resolve("/foo/bar/baz.js")]="beep",resolve("./baz",r("/foo/bar"),function(t,r,n){return t?e.fail(t):(e.equal(r,path.resolve("/foo/bar/baz.js")),void e.equal(n&&n.main,"bar"))}),resolve("./baz.js",r("/foo/bar"),function(t,r,n){return t?e.fail(t):(e.equal(r,path.resolve("/foo/bar/baz.js")),void e.equal(n&&n.main,"bar"))}),resolve("baz",r("/foo/bar"),function(t,r){e.equal(t.message,"Cannot find module 'baz' from '"+path.resolve("/foo/bar")+"'"),e.equal(t.code,"MODULE_NOT_FOUND")}),resolve("../baz",r("/foo/bar"),function(t,r){e.equal(t.message,"Cannot find module '../baz' from '"+path.resolve("/foo/bar")+"'"),e.equal(t.code,"MODULE_NOT_FOUND")})}),test("mock package",function(e){function r(e){return{basedir:path.resolve(e),isFile:function(e,r){r(null,Object.prototype.hasOwnProperty.call(t,path.resolve(e)))},readFile:function(e,r){r(null,t[path.resolve(e)])}}}e.plan(2);var t={};t[path.resolve("/foo/node_modules/bar/baz.js")]="beep",t[path.resolve("/foo/node_modules/bar/package.json")]=JSON.stringify({main:"./baz.js"}),resolve("bar",r("/foo"),function(t,r,n){return t?e.fail(t):(e.equal(r,path.resolve("/foo/node_modules/bar/baz.js")),void e.equal(n&&n.main,"./baz.js"))})}),test("mock package from package",function(e){function r(e){return{basedir:path.resolve(e),isFile:function(e,r){r(null,Object.prototype.hasOwnProperty.call(t,path.resolve(e)))},"package":{main:"bar"},readFile:function(e,r){r(null,t[path.resolve(e)])}}}e.plan(2);var t={};t[path.resolve("/foo/node_modules/bar/baz.js")]="beep",t[path.resolve("/foo/node_modules/bar/package.json")]=JSON.stringify({main:"./baz.js"}),resolve("bar",r("/foo"),function(t,r,n){return t?e.fail(t):(e.equal(r,path.resolve("/foo/node_modules/bar/baz.js")),void e.equal(n&&n.main,"./baz.js"))})});