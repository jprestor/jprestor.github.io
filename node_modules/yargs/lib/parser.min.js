function increment(e){return void 0!==e?e+1:0}var camelCase=require("camelcase"),path=require("path");module.exports=function(e,t){function g(e,r,n){var i=E(r,t.narg);if(n.length-(e+1)<i)throw Error("not enough arguments following: "+r);for(var a=e+1;i+e+1>a;a++)b(r,n[a]);return e+i}function y(e,t,r){for(var n=e+1;n<r.length&&!/^-/.test(r[n]);n++)e=n,b(t,r[n]);return e}function b(e,t){if((E(e,r.bools)||E(e,r.counts))&&"string"==typeof t&&(t="true"===t),/-/.test(e)&&(!n[e]||!n[e].length)){var a=camelCase(e);n[e]=[a],i[a]=!0}var s=!E(e,r.strings)&&C(t)?Number(t):t;E(e,r.counts)&&(s=increment);var u=e.split(".");S(o,u,s),(n[u[0]]||[]).forEach(function(e){if(e=e.split("."),u.length>1){var t=[].concat(u);t.shift(),e=e.concat(t)}S(o,e,s)});for(var l=[e].concat(n[e]||[]),c=0,f=l.length;f>c;c++)if(r.normalize[l[c]]){l.forEach(function(e){o.__defineSetter__(e,function(e){t=path.normalize(e)}),o.__defineGetter__(e,function(){return"string"==typeof t?path.normalize(t):t})});break}}function w(e){var t={};x(t,n,a),Object.keys(r.configs).forEach(function(r){var n=e[r]||t[r];if(n)try{var i=require(path.resolve(process.cwd(),n));Object.keys(i).forEach(function(t){void 0===e[t]&&(delete e[t],b(t,i[t]))})}catch(a){throw Error("invalid json config file: "+n)}})}function x(e,t,r){Object.keys(r).forEach(function(n){_(e,n.split("."))||(S(e,n.split("."),r[n]),(t[n]||[]).forEach(function(t){S(e,t.split("."),r[n])}))})}function _(e,t){var r=e;t.slice(0,-1).forEach(function(e){r=r[e]||{}});var n=t[t.length-1];return n in r}function S(e,t,n){var i=e;t.slice(0,-1).forEach(function(e){void 0===i[e]&&(i[e]={}),i=i[e]});var a=t[t.length-1];n===increment?i[a]=increment(i[a]):void 0===i[a]&&E(a,r.arrays)?i[a]=Array.isArray(n)?n:[n]:void 0===i[a]||"boolean"==typeof i[a]?i[a]=n:Array.isArray(i[a])?i[a].push(n):i[a]=[i[a],n]}function k(e){Object.keys(e||{}).forEach(function(e){n[e]=[].concat(t.alias[e]||[]),n[e].concat(e).forEach(function(t){if(/-/.test(t)){var r=camelCase(t);n[e].push(r),i[r]=!0}}),n[e].forEach(function(t){n[t]=[e].concat(n[e].filter(function(e){return t!==e}))})})}function E(e,t){var r=!1,i=[].concat(n[e]||[],e);return i.forEach(function(e){t[e]&&(r=t[e])}),r}function A(e){var t={"boolean":!0,string:"",array:[]};return t[e]}function j(e,t){var r="boolean";return t.strings&&t.strings[e]?r="string":t.arrays&&t.arrays[e]&&(r="array"),r}function C(e){return"number"==typeof e?!0:/^0x[0-9a-f]+$/i.test(e)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e)}t||(t={});var r={arrays:{},bools:{},strings:{},counts:{},normalize:{},configs:{}};[].concat(t.array).filter(Boolean).forEach(function(e){r.arrays[e]=!0}),[].concat(t["boolean"]).filter(Boolean).forEach(function(e){r.bools[e]=!0}),[].concat(t.string).filter(Boolean).forEach(function(e){r.strings[e]=!0}),[].concat(t.count).filter(Boolean).forEach(function(e){r.counts[e]=!0}),[].concat(t.normalize).filter(Boolean).forEach(function(e){r.normalize[e]=!0}),[].concat(t.config).filter(Boolean).forEach(function(e){r.configs[e]=!0});var n={},i={};k(t.key),k(t.alias);var a=t["default"]||{};Object.keys(a).forEach(function(e){/-/.test(e)&&!t.alias[e]&&(n[e]=n[e]||[]),(n[e]||[]).forEach(function(t){a[t]=a[e]})});var o={_:[]};Object.keys(r.bools).forEach(function(e){b(e,e in a?a[e]:!1)});var s=[];-1!==e.indexOf("--")&&(s=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var u=0;u<e.length;u++){var c,f,p,h,d,m,l=e[u];if(l.match(/^--.+=/))h=l.match(/^--([^=]+)=([\s\S]*)$/),E(h[1],t.narg)?(e.splice(u+1,h[1],h[2]),u=g(u,h[1],e)):E(h[1],r.arrays)&&e.length>u+1?(e.splice(u+1,h[1],h[2]),u=y(u,h[1],e)):b(h[1],h[2]);else if(l.match(/^--no-.+/))f=l.match(/^--no-(.+)/)[1],b(f,!1);else if(l.match(/^--.+/))f=l.match(/^--(.+)/)[1],E(f,t.narg)?u=g(u,f,e):E(f,r.arrays)&&e.length>u+1?u=y(u,f,e):(d=e[u+1],void 0===d||d.match(/^-/)||E(f,r.bools)||E(f,r.counts)?/^(true|false)$/.test(d)?(b(f,d),u++):b(f,A(j(f,r))):(b(f,d),u++));else if(l.match(/^-.\..+=/))h=l.match(/^-([^=]+)=([\s\S]*)$/),b(h[1],h[2]);else if(l.match(/^-.\..+/))d=e[u+1],f=l.match(/^-(.\..+)/)[1],void 0===d||d.match(/^-/)||E(f,r.bools)||E(f,r.counts)?b(f,A(j(f,r))):(b(f,d),u++);else if(l.match(/^-[^-]+/)){p=l.slice(1,-1).split(""),c=!1;for(var v=0;v<p.length;v++){if(d=l.slice(v+2),p[v+1]&&"="===p[v+1]){m=l.slice(v+3),f=p[v],E(p[v],t.narg)?(e.splice(u+1,0,m),u=g(u,f,e)):E(f,r.arrays)&&e.length>u+1?(e.splice(u+1,0,m),u=y(u,f,e)):b(f,m),c=!0;break}if("-"!==d){if(/[A-Za-z]/.test(p[v])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(d)){b(p[v],d),c=!0;break}if(p[v+1]&&p[v+1].match(/\W/)){b(p[v],l.slice(v+2)),c=!0;break}b(p[v],A(j(p[v],r)))}else b(p[v],d)}f=l.slice(-1)[0],c||"-"===f||(E(f,t.narg)?u=g(u,f,e):E(f,r.arrays)&&e.length>u+1?u=y(u,f,e):!e[u+1]||/^(-|--)[^-]/.test(e[u+1])||E(f,r.bools)||E(f,r.counts)?e[u+1]&&/true|false/.test(e[u+1])?(b(f,e[u+1]),u++):b(f,A(j(f,r))):(b(f,e[u+1]),u++))}else o._.push(r.strings._||!C(l)?l:Number(l))}return w(o),x(o,n,a),Object.keys(r.counts).forEach(function(e){b(e,a[e])}),s.forEach(function(e){o._.push(e)}),{argv:o,aliases:n,newAliases:i}};