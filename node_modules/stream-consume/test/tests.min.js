"use strict";var consume=require("../"),Stream=require("stream"),Readable=Stream.Readable,Writable=Stream.Writable,Duplex=Stream.Duplex,should=require("should"),through=require("through2");require("mocha"),describe("stream-consume",function(){it("should cause a Readable stream to complete if it's not piped anywhere",function(e){var t=new Readable({highWaterMark:2}),r=0,n=!1;t._read=function(){r++<100?t.push(r+""):(n=!0,t.push(null))},t.on("end",function(){r.should.be.above(99),n.should.be["true"],e()}),consume(t)}),it("should work with Readable streams in objectMode",function(e){var t=new Readable({highWaterMark:2,objectMode:!0}),r=0,n=!1;t._read=function(){r++<100?t.push(r):(n=!0,t.push(null))},t.on("end",function(){r.should.be.above(99),n.should.be["true"],e()}),consume(t)}),it("should not interfere with a Readable stream that is piped somewhere",function(e){var t=new Readable({highWaterMark:2}),r=0,n=!1;t._read=function(){r++<100?t.push("."):(n=!0,t.push(null))};var i=0,a=new Writable({highWaterMark:2});a._write=function(e,t,r){i+=e.length,r()},a.on("finish",function(){r.should.be.above(99),n.should.be["true"],i.should.equal(100),e()}),t.pipe(a),consume(t)}),it("should not interfere with a Writable stream",function(e){var t=new Readable({highWaterMark:2}),r=0,n=!1;t._read=function(){r++<100?t.push("."):(n=!0,t.push(null))};var i=0,a=new Writable({highWaterMark:2});a._write=function(e,t,r){i+=e.length,r()},a.on("finish",function(){r.should.be.above(99),n.should.be["true"],i.should.equal(100),e()}),t.pipe(a),consume(a)}),it("should handle a Transform stream",function(e){var t=new Readable({highWaterMark:2}),r=0,n=!1;t._read=function(){r++<100?t.push("."):(n=!0,t.push(null))};var i=0,a=!1,o=through({highWaterMark:2},function(e,t,r){i+=e.length,this.push(e),r()},function(e){a=!0,e()});o.on("end",function(){r.should.be.above(99),n.should.be["true"],i.should.equal(100),a.should.be["true"],e()}),t.pipe(o),consume(o)}),it("should handle a classic stream",function(e){var n,t=new Stream,r=!1;for(t.on("end",function(){r.should.be["true"],e()}),consume(t),n=0;100>n;n++)t.emit("data",n);r=!0,t.emit("end")})});