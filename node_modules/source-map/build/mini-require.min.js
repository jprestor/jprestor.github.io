function define(e,t,r){if("string"!=typeof e)throw new TypeError("Expected string, got: "+e);if(2==arguments.length&&(r=t),e in define.modules)throw new Error("Module already defined: "+e);define.modules[e]=r}function Domain(){this.modules={},this._currentModule=null}define.modules={},function(){function e(e){for(var t=e.split("/"),r=1;r<t.length;)".."===t[r]?t.splice(r-1,1):"."===t[r]?t.splice(r,1):r++;return t.join("/")}function t(e,t){return e=e.trim(),t=t.trim(),/^\//.test(t)?t:e.replace(/\/*$/,"/")+t}function r(e){var t=e.split("/");return t.pop(),t.join("/")}Domain.prototype.require=function(e,t){if(Array.isArray(e)){var r=e.map(function(e){return this.lookup(e)},this);return void(t&&t.apply(null,r))}return this.lookup(e)},Domain.prototype.lookup=function(n){if(/^\./.test(n)&&(n=e(t(r(this._currentModule),n))),n in this.modules){var i=this.modules[n];return i}if(!(n in define.modules))throw new Error("Module not defined: "+n);var i=define.modules[n];if("function"==typeof i){var a={},o=this._currentModule;this._currentModule=n,i(this.require.bind(this),a,{id:n,uri:""}),this._currentModule=o,i=a}return this.modules[n]=i,i}}(),define.Domain=Domain,define.globalDomain=new Domain;var require=define.globalDomain.require.bind(define.globalDomain);