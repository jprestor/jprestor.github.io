!function(e){"use strict";e(function(){return function(e){function i(e,t){this._handler=e===S?t:a(e)}function a(e){function n(e){t.resolve(e)}function i(e){t.reject(e)}function a(e){t.notify(e)}var t=new E;try{e(n,i,a)}catch(r){i(r)}return t}function o(e){return H(e)?e:new i(S,new A(b(e)))}function s(e){return new i(S,new A(new T(e)))}function u(){return I}function l(){return new i(S,new E)}function c(e,t){var r=new E(e.receiver,e.join().context);return new t(S,r)}function f(e){return h(Y,null,e)}function p(e,t){return h($,e,t)}function h(e,t,r){function c(n,i,a){a.resolved||d(r,f,n,e(t,i,n),a)}function f(e,t,r){s[e]=t,0===--o&&r.become(new C(s))}for(var l,n="function"==typeof t?c:f,a=new E,o=r.length>>>0,s=new Array(o),u=0;u<r.length&&!a.resolved;++u)l=r[u],void 0!==l||u in r?d(r,n,u,l,a):--o;return 0===o&&a.become(new C(s)),new i(S,a)}function d(e,t,r,n,i){if(U(n)){var a=w(n),o=a.state();0===o?a.fold(t,r,void 0,i):o>0?t(r,a.value,i):(i.become(a),m(e,r+1,a))}else t(r,n,i)}function m(e,t,r){for(var n=t;n<e.length;++n)g(b(e[n]),r)}function g(e,t){if(e!==t){var r=e.state();0===r?e.visit(e,void 0,e._unreport):0>r&&e._unreport()}}function v(e){return"object"!=typeof e||null===e?s(new TypeError("non-iterable passed to race()")):0===e.length?u():1===e.length?o(e[0]):y(e)}function y(e){var r,n,a,t=new E;for(r=0;r<e.length;++r)if(n=e[r],void 0!==n||r in e){if(a=b(n),0!==a.state()){t.become(a),m(e,r+1,a);break}a.visit(t,t.resolve,t.reject)}return new i(S,t)}function b(e){return H(e)?e._handler.join():U(e)?x(e):new C(e)}function w(e){return H(e)?e._handler.join():x(e)}function x(e){try{var t=e.then;return"function"==typeof t?new j(t,e):new C(e)}catch(r){return new T(r)}}function S(){}function _(){}function E(e,t){i.createContext(this,t),this.consumers=void 0,this.receiver=e,this.handler=void 0,this.resolved=!1}function A(e){this.handler=e}function j(e,r){E.call(this),t.enqueue(new N(e,r,this))}function C(e){i.createContext(this),this.value=e}function T(e){i.createContext(this),this.id=++q,this.value=e,this.handled=!1,this.reported=!1,this._report()}function O(e,t){this.rejection=e,this.context=t}function R(e){this.rejection=e}function M(){return new T(new TypeError("Promise cycle"))}function F(e,t){this.continuation=e,this.handler=t}function D(e,t){this.handler=t,this.value=e}function N(e,t,r){this._then=e,this.thenable=t,this.resolver=r}function L(e,t,r,n,i){try{e.call(t,r,n,i)}catch(a){n(a)}}function B(e,t,r,n){this.f=e,this.z=t,this.c=r,this.to=n,this.resolver=k,this.receiver=this}function H(e){return e instanceof i}function U(e){return("object"==typeof e||"function"==typeof e)&&null!==e}function z(e,t,r,n){return"function"!=typeof e?n.become(t):(i.enterContext(t),W(e,t.value,r,n),void i.exitContext())}function V(e,t,r,n,a){return"function"!=typeof e?a.become(r):(i.enterContext(r),K(e,t,r.value,n,a),void i.exitContext())}function G(e,t,r,n,a){return"function"!=typeof e?a.notify(t):(i.enterContext(r),X(e,t,n,a),void i.exitContext())}function $(e,t,r){try{return e(t,r)}catch(n){return s(n)}}function W(e,t,r,n){try{n.become(b(e.call(r,t)))}catch(i){n.become(new T(i))}}function K(e,t,r,n,i){try{e.call(n,t,r,i)}catch(a){i.become(new T(a))}}function X(e,t,r,n){try{n.notify(e.call(r,t))}catch(i){n.notify(i)}}function J(e,t){t.prototype=n(e.prototype),t.prototype.constructor=t}function Y(e,t){return t}function Q(){}function Z(){if("function"==typeof CustomEvent)try{var e=new CustomEvent("unhandledRejection");return e instanceof CustomEvent}catch(t){}return!1}function ee(){if("undefined"!=typeof document&&"function"==typeof document.createEvent)try{var e=document.createEvent("CustomEvent");return e.initCustomEvent("eventType",!1,!0,{}),!0}catch(t){}return!1}function te(){return"undefined"!=typeof process&&null!==process&&"function"==typeof process.emit?function(e,t){return"unhandledRejection"===e?process.emit(e,t.value,t):process.emit(e,t)}:"undefined"!=typeof self&&Z()?function(e,t){return function(r,n){var i=new t(r,{detail:{reason:n.value,key:n},bubbles:!1,cancelable:!0});return!e.dispatchEvent(i)}}(self,CustomEvent):"undefined"!=typeof self&&ee()?function(e,t){return function(r,n){var i=t.createEvent("CustomEvent");return i.initCustomEvent(r,!1,!0,{reason:n.value,key:n}),!e.dispatchEvent(i)}}(self,document):Q}var t=e.scheduler,r=te(),n=Object.create||function(e){function t(){}return t.prototype=e,new t};i.resolve=o,i.reject=s,i.never=u,i._defer=l,i._handler=b,i.prototype.then=function(e,t,r){var n=this._handler,i=n.join().state();if("function"!=typeof e&&i>0||"function"!=typeof t&&0>i)return new this.constructor(S,n);var a=this._beget(),o=a._handler;return n.chain(o,n.receiver,e,t,r),a},i.prototype["catch"]=function(e){return this.then(void 0,e)},i.prototype._beget=function(){return c(this._handler,this.constructor)},i.all=f,i.race=v,i._traverse=p,i._visitRemaining=m,S.prototype.when=S.prototype.become=S.prototype.notify=S.prototype.fail=S.prototype._unreport=S.prototype._report=Q,S.prototype._state=0,S.prototype.state=function(){return this._state},S.prototype.join=function(){for(var e=this;void 0!==e.handler;)e=e.handler;return e},S.prototype.chain=function(e,t,r,n,i){this.when({resolver:e,receiver:t,fulfilled:r,rejected:n,progress:i})},S.prototype.visit=function(e,t,r,n){this.chain(k,e,t,r,n)},S.prototype.fold=function(e,t,r,n){this.when(new B(e,t,r,n))},J(S,_),_.prototype.become=function(e){e.fail()};var k=new _;J(S,E),E.prototype._state=0,E.prototype.resolve=function(e){this.become(b(e))},E.prototype.reject=function(e){this.resolved||this.become(new T(e))},E.prototype.join=function(){if(!this.resolved)return this;for(var e=this;void 0!==e.handler;)if(e=e.handler,e===this)return this.handler=M();return e},E.prototype.run=function(){var e=this.consumers,t=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var r=0;r<e.length;++r)t.when(e[r])},E.prototype.become=function(e){this.resolved||(this.resolved=!0,this.handler=e,void 0!==this.consumers&&t.enqueue(this),void 0!==this.context&&e._report(this.context))},E.prototype.when=function(e){this.resolved?t.enqueue(new F(e,this.handler)):void 0===this.consumers?this.consumers=[e]:this.consumers.push(e)},E.prototype.notify=function(e){this.resolved||t.enqueue(new D(e,this))},E.prototype.fail=function(e){var t="undefined"==typeof e?this.context:e;this.resolved&&this.handler.join().fail(t)},E.prototype._report=function(e){this.resolved&&this.handler.join()._report(e)},E.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},J(S,A),A.prototype.when=function(e){t.enqueue(new F(e,this))},A.prototype._report=function(e){this.join()._report(e)},A.prototype._unreport=function(){this.join()._unreport()},J(E,j),J(S,C),C.prototype._state=1,C.prototype.fold=function(e,t,r,n){V(e,t,this,r,n)},C.prototype.when=function(e){z(e.fulfilled,this,e.receiver,e.resolver)};var q=0;J(S,T),T.prototype._state=-1,T.prototype.fold=function(e,t,r,n){n.become(this)},T.prototype.when=function(e){"function"==typeof e.rejected&&this._unreport(),z(e.rejected,this,e.receiver,e.resolver)},T.prototype._report=function(e){t.afterQueue(new O(this,e))},T.prototype._unreport=function(){this.handled||(this.handled=!0,t.afterQueue(new R(this)))},T.prototype.fail=function(e){this.reported=!0,r("unhandledRejection",this),i.onFatalRejection(this,void 0===e?this.context:e)},O.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,r("unhandledRejection",this.rejection)||i.onPotentiallyUnhandledRejection(this.rejection,this.context))},R.prototype.run=function(){this.rejection.reported&&(r("rejectionHandled",this.rejection)||i.onPotentiallyUnhandledRejectionHandled(this.rejection))},i.createContext=i.enterContext=i.exitContext=i.onPotentiallyUnhandledRejection=i.onPotentiallyUnhandledRejectionHandled=i.onFatalRejection=Q;var P=new S,I=new i(S,P);return F.prototype.run=function(){this.handler.join().when(this.continuation)},D.prototype.run=function(){var e=this.handler.consumers;if(void 0!==e)for(var t,r=0;r<e.length;++r)t=e[r],G(t.progress,this.value,this.handler,t.receiver,t.resolver)},N.prototype.run=function(){function t(t){e.resolve(t)}function r(t){e.reject(t)}function n(t){e.notify(t)}var e=this.resolver;L(this._then,this.thenable,t,r,n)},B.prototype.fulfilled=function(e){this.f.call(this.c,this.z,e,this.to)},B.prototype.rejected=function(e){this.to.reject(e)},B.prototype.progress=function(e){this.to.notify(e)},i}})}("function"==typeof define&&define.amd?define:function(e){module.exports=e()});