!function(e){e(function(e){function n(e,n){return function(){var i=r.call(arguments);return t(e()).withThis(this).then(function(e){return t(n.apply(this,i))["finally"](e)})}}function i(e){function i(){r=Math.max(r-1,0),n.length>0&&n.shift()(i)}var r=0,n=[];return function(){return t.promise(function(t){e>r?t(i):n.push(t),r+=1})}}var t=e("./when"),r=Array.prototype.slice;return n.n=i,n})}("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)});