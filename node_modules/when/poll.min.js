!function(e){"use strict";e(function(e){var t=e("./when"),r=t["try"],n=e("./cancelable");return function(e,i,a,o){function c(e){s.resolve(e)}function f(e){r(i).then(p,l),void 0!==e&&s.notify(e)}function p(){u||t(e(),function(e){t(a(e),function(t){return t?c(e):f(e)},function(){f(e)})},l)}var s,u,l;return u=!1,s=n(t.defer(),function(){u=!0}),l=s.reject,a=a||function(){return!1},"function"!=typeof i&&(i=function(e){return function(){return t().delay(e)}}(i)),o?f():p(),s.promise=Object.create(s.promise),s.promise.cancel=s.cancel,s.promise}})}("function"==typeof define&&define.amd?define:function(e){module.exports=e(require)});