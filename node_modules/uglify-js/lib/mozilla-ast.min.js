"use strict";!function(){function r(e){return"Literal"==e.type?null!=e.raw?e.raw:e.value+"":void 0}function n(e){var t=e.loc,n=t&&t.start,i=e.range;return new AST_Token({file:t&&t.source,line:n&&n.line,col:n&&n.column,pos:i?i[0]:e.start,endline:n&&n.line,endcol:n&&n.column,endpos:i?i[0]:e.start,raw:r(e)})}function i(e){var t=e.loc,n=t&&t.end,i=e.range;return new AST_Token({file:t&&t.source,line:n&&n.line,col:n&&n.column,pos:i?i[1]:e.end,endline:n&&n.line,endcol:n&&n.column,endpos:i?i[1]:e.end,raw:r(e)})}function a(e,r,a){var o="function From_Moz_"+e+"(M){\n";o+="return new U2."+r.name+"({\nstart: my_start_token(M),\nend: my_end_token(M)";var u="function To_Moz_"+e+"(M){\n";u+="return {\ntype: "+JSON.stringify(e),a&&a.split(/\s*,\s*/).forEach(function(e){var t=/([a-z0-9$_]+)(=|@|>|%)([a-z0-9$_]+)/i.exec(e);if(!t)throw new Error("Can't understand property map: "+e);var r=t[1],n=t[2],i=t[3];switch(o+=",\n"+i+": ",u+=",\n"+r+": ",n){case"@":o+="M."+r+".map(from_moz)",u+="M."+i+".map(to_moz)";break;case">":o+="from_moz(M."+r+")",u+="to_moz(M."+i+")";break;case"=":o+="M."+r,u+="M."+i;break;case"%":o+="from_moz(M."+r+").body",u+="to_moz_block(M)";break;default:throw new Error("Can't understand operator in propmap: "+e)}}),o+="\n})\n}",u+="\n}\n}",o=new Function("U2","my_start_token","my_end_token","from_moz","return("+o+")")(exports,n,i,s),u=new Function("to_moz","to_moz_block","to_moz_scope","return("+u+")")(c,f,p),t[e]=o,l(r,u)}function s(e){o.push(e);var r=null!=e?t[e.type](e):null;return o.pop(),r}function u(e,t,r){var n=e.start,i=e.end;return null!=n.pos&&null!=i.endpos&&(t.range=[n.pos,i.endpos]),n.line&&(t.loc={start:{line:n.line,column:n.col},end:i.endline?{line:i.endline,column:i.endcol}:null},n.file&&(t.loc.source=n.file)),t}function l(e,t){e.DEFMETHOD("to_mozilla_ast",function(){return u(this,t(this))})}function c(e){return null!=e?e.to_mozilla_ast():null}function f(e){return{type:"BlockStatement",body:e.body.map(c)}}function p(e,t){var r=t.body.map(c);return t.body[0]instanceof AST_SimpleStatement&&t.body[0].body instanceof AST_String&&r.unshift(c(new AST_EmptyStatement(t.body[0]))),{type:e,body:r}}var e=function(e){for(var t=!0,r=0;r<e.length;r++)t&&e[r]instanceof AST_Statement&&e[r].body instanceof AST_String?e[r]=new AST_Directive({start:e[r].start,end:e[r].end,value:e[r].body.value}):!t||e[r]instanceof AST_Statement&&e[r].body instanceof AST_String||(t=!1);return e},t={Program:function(t){return new AST_Toplevel({start:n(t),end:i(t),body:e(t.body.map(s))})},FunctionDeclaration:function(t){return new AST_Defun({start:n(t),end:i(t),name:s(t.id),argnames:t.params.map(s),body:e(s(t.body).body)})},FunctionExpression:function(t){return new AST_Function({start:n(t),end:i(t),name:s(t.id),argnames:t.params.map(s),body:e(s(t.body).body)})},ExpressionStatement:function(e){return new AST_SimpleStatement({start:n(e),end:i(e),body:s(e.expression)})},TryStatement:function(e){var t=e.handlers||[e.handler];if(t.length>1||e.guardedHandlers&&e.guardedHandlers.length)throw new Error("Multiple catch clauses are not supported.");return new AST_Try({start:n(e),end:i(e),body:s(e.block).body,bcatch:s(t[0]),bfinally:e.finalizer?new AST_Finally(s(e.finalizer)):null})},Property:function(e){var t=e.key,r={start:n(t),end:i(e.value),key:"Identifier"==t.type?t.name:t.value,value:s(e.value)};return"init"==e.kind?new AST_ObjectKeyVal(r):(r.key=new AST_SymbolAccessor({name:r.key}),r.value=new AST_Accessor(r.value),"get"==e.kind?new AST_ObjectGetter(r):"set"==e.kind?new AST_ObjectSetter(r):void 0)},ArrayExpression:function(e){return new AST_Array({start:n(e),end:i(e),elements:e.elements.map(function(e){return null===e?new AST_Hole:s(e)})})},ObjectExpression:function(e){return new AST_Object({start:n(e),end:i(e),properties:e.properties.map(function(e){return e.type="Property",s(e)})})},SequenceExpression:function(e){return AST_Seq.from_array(e.expressions.map(s))},MemberExpression:function(e){return new(e.computed?AST_Sub:AST_Dot)({start:n(e),end:i(e),property:e.computed?s(e.property):e.property.name,expression:s(e.object)})},SwitchCase:function(e){return new(e.test?AST_Case:AST_Default)({start:n(e),end:i(e),expression:s(e.test),body:e.consequent.map(s)})},VariableDeclaration:function(e){return new("const"===e.kind?AST_Const:AST_Var)({start:n(e),end:i(e),definitions:e.declarations.map(s)})},Literal:function(e){var t=e.value,r={start:n(e),end:i(e)};if(null===t)return new AST_Null(r);switch(typeof t){case"string":return r.value=t,new AST_String(r);case"number":return r.value=t,new AST_Number(r);case"boolean":return new(t?AST_True:AST_False)(r);default:var a=e.regex;return a&&a.pattern?r.value=new RegExp(a.pattern,a.flags).toString():r.value=e.regex&&e.raw?e.raw:t,new AST_RegExp(r)}},Identifier:function(e){var t=o[o.length-2];return new("LabeledStatement"==t.type?AST_Label:"VariableDeclarator"==t.type&&t.id===e?"const"==t.kind?AST_SymbolConst:AST_SymbolVar:"FunctionExpression"==t.type?t.id===e?AST_SymbolLambda:AST_SymbolFunarg:"FunctionDeclaration"==t.type?t.id===e?AST_SymbolDefun:AST_SymbolFunarg:"CatchClause"==t.type?AST_SymbolCatch:"BreakStatement"==t.type||"ContinueStatement"==t.type?AST_LabelRef:AST_SymbolRef)({start:n(e),end:i(e),name:e.name})}};t.UpdateExpression=t.UnaryExpression=function(e){var t="prefix"in e?e.prefix:"UnaryExpression"==e.type?!0:!1;return new(t?AST_UnaryPrefix:AST_UnaryPostfix)({start:n(e),end:i(e),operator:e.operator,expression:s(e.argument)})},a("EmptyStatement",AST_EmptyStatement),a("BlockStatement",AST_BlockStatement,"body@body"),a("IfStatement",AST_If,"test>condition, consequent>body, alternate>alternative"),a("LabeledStatement",AST_LabeledStatement,"label>label, body>body"),a("BreakStatement",AST_Break,"label>label"),a("ContinueStatement",AST_Continue,"label>label"),a("WithStatement",AST_With,"object>expression, body>body"),a("SwitchStatement",AST_Switch,"discriminant>expression, cases@body"),a("ReturnStatement",AST_Return,"argument>value"),a("ThrowStatement",AST_Throw,"argument>value"),a("WhileStatement",AST_While,"test>condition, body>body"),a("DoWhileStatement",AST_Do,"test>condition, body>body"),a("ForStatement",AST_For,"init>init, test>condition, update>step, body>body"),a("ForInStatement",AST_ForIn,"left>init, right>object, body>body"),a("DebuggerStatement",AST_Debugger),a("VariableDeclarator",AST_VarDef,"id>name, init>value"),a("CatchClause",AST_Catch,"param>argname, body%body"),a("ThisExpression",AST_This),a("BinaryExpression",AST_Binary,"operator=operator, left>left, right>right"),a("LogicalExpression",AST_Binary,"operator=operator, left>left, right>right"),a("AssignmentExpression",AST_Assign,"operator=operator, left>left, right>right"),a("ConditionalExpression",AST_Conditional,"test>condition, consequent>consequent, alternate>alternative"),a("NewExpression",AST_New,"callee>expression, arguments@args"),a("CallExpression",AST_Call,"callee>expression, arguments@args"),l(AST_Toplevel,function(e){return p("Program",e)}),l(AST_Defun,function(e){return{type:"FunctionDeclaration",id:c(e.name),params:e.argnames.map(c),body:p("BlockStatement",e)}}),l(AST_Function,function(e){return{type:"FunctionExpression",id:c(e.name),params:e.argnames.map(c),body:p("BlockStatement",e)}}),l(AST_Directive,function(e){return{type:"ExpressionStatement",expression:{type:"Literal",value:e.value}}}),l(AST_SimpleStatement,function(e){return{type:"ExpressionStatement",expression:c(e.body)}}),l(AST_SwitchBranch,function(e){return{type:"SwitchCase",test:c(e.expression),consequent:e.body.map(c)}}),l(AST_Try,function(e){return{type:"TryStatement",block:f(e),handler:c(e.bcatch),guardedHandlers:[],finalizer:c(e.bfinally)}}),l(AST_Catch,function(e){return{type:"CatchClause",param:c(e.argname),guard:null,body:f(e)}}),l(AST_Definitions,function(e){return{type:"VariableDeclaration",kind:e instanceof AST_Const?"const":"var",declarations:e.definitions.map(c)}}),l(AST_Seq,function(e){return{type:"SequenceExpression",expressions:e.to_array().map(c)}}),l(AST_PropAccess,function(e){var t=e instanceof AST_Sub;return{type:"MemberExpression",object:c(e.expression),computed:t,property:t?c(e.property):{type:"Identifier",name:e.property}}}),l(AST_Unary,function(e){return{type:"++"==e.operator||"--"==e.operator?"UpdateExpression":"UnaryExpression",operator:e.operator,prefix:e instanceof AST_UnaryPrefix,argument:c(e.expression)}}),l(AST_Binary,function(e){return{type:"&&"==e.operator||"||"==e.operator?"LogicalExpression":"BinaryExpression",left:c(e.left),operator:e.operator,right:c(e.right)}}),l(AST_Array,function(e){return{type:"ArrayExpression",elements:e.elements.map(c)}}),l(AST_Object,function(e){return{type:"ObjectExpression",properties:e.properties.map(c)}}),l(AST_ObjectProperty,function(e){var r,t={type:"Literal",value:e.key instanceof AST_SymbolAccessor?e.key.name:e.key};return e instanceof AST_ObjectKeyVal?r="init":e instanceof AST_ObjectGetter?r="get":e instanceof AST_ObjectSetter&&(r="set"),{type:"Property",kind:r,key:t,value:c(e.value)}}),l(AST_Symbol,function(e){var t=e.definition();return{type:"Identifier",name:t?t.mangled_name||t.name:e.name}}),l(AST_RegExp,function(e){var t=e.value;return{type:"Literal",value:t,raw:t.toString(),regex:{pattern:t.source,flags:t.toString().match(/[gimuy]*$/)[0]}}}),l(AST_Constant,function(e){var t=e.value;return"number"==typeof t&&(0>t||0===t&&0>1/t)?{type:"UnaryExpression",operator:"-",prefix:!0,argument:{type:"Literal",value:-t,raw:e.start.raw}}:{type:"Literal",value:t,raw:e.start.raw}}),l(AST_Atom,function(e){return{type:"Identifier",name:String(e.value)}}),AST_Boolean.DEFMETHOD("to_mozilla_ast",AST_Constant.prototype.to_mozilla_ast),AST_Null.DEFMETHOD("to_mozilla_ast",AST_Constant.prototype.to_mozilla_ast),AST_Hole.DEFMETHOD("to_mozilla_ast",function(){return null}),AST_Block.DEFMETHOD("to_mozilla_ast",AST_BlockStatement.prototype.to_mozilla_ast),AST_Lambda.DEFMETHOD("to_mozilla_ast",AST_Function.prototype.to_mozilla_ast);var o=null;AST_Node.from_mozilla_ast=function(e){var t=o;o=[];var r=s(e);return o=t,r}}();