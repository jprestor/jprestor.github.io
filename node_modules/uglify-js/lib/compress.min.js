"use strict";function Compressor(e,t){if(!(this instanceof Compressor))return new Compressor(e,t);TreeTransformer.call(this,this.before,this.after),this.options=defaults(e,{angular:!1,booleans:!t,cascade:!t,collapse_vars:!t,comparisons:!t,conditionals:!t,dead_code:!t,drop_console:!1,drop_debugger:!t,evaluate:!t,expression:!1,global_defs:{},hoist_funs:!t,hoist_vars:!1,if_return:!t,join_vars:!t,keep_fargs:!0,keep_fnames:!1,keep_infinity:!1,loops:!t,negate_iife:!t,passes:1,properties:!t,pure_getters:!t&&"strict",pure_funcs:null,reduce_vars:!t,screw_ie8:!0,sequences:!t,side_effects:!t,switches:!t,top_retain:null,toplevel:!(!e||!e.top_retain),unsafe:!1,unsafe_comps:!1,unsafe_math:!1,unsafe_proto:!1,unsafe_regexp:!1,unused:!t,warnings:!0},!0);var r=this.options.pure_funcs;"function"==typeof r?this.pure_funcs=r:this.pure_funcs=r?function(e){return r.indexOf(e.expression.print_to_string())<0}:return_true;var n=this.options.top_retain;n instanceof RegExp?this.top_retain=function(e){return n.test(e.name)}:"function"==typeof n?this.top_retain=n:n&&("string"==typeof n&&(n=n.split(/,/)),this.top_retain=function(e){return n.indexOf(e.name)>=0});var i=this.options.sequences;this.sequences_limit=1==i?200:0|i,this.warnings_produced={}}Compressor.prototype=new TreeTransformer,merge(Compressor.prototype,{option:function(e){return this.options[e]},compress:function(e){this.option("expression")&&(e=e.process_expression(!0));for(var t=+this.options.passes||1,r=0;t>r&&3>r;++r)(r>0||this.option("reduce_vars"))&&e.reset_opt_flags(this,!0),e=e.transform(this);return this.option("expression")&&(e=e.process_expression(!1)),e},info:function(){"verbose"==this.options.warnings&&AST_Node.warn.apply(AST_Node,arguments)},warn:function(e,t){if(this.options.warnings){var r=string_template(e,t);r in this.warnings_produced||(this.warnings_produced[r]=!0,AST_Node.warn.apply(AST_Node,arguments))}},clear_warnings:function(){this.warnings_produced={}},before:function(e,t,r){if(e._squeezed)return e;var n=!1;e instanceof AST_Scope&&(e=e.hoist_declarations(this),n=!0),t(e,this),t(e,this);var i=e.optimize(this);return n&&i instanceof AST_Scope&&(i.drop_unused(this),t(i,this)),i===e&&(i._squeezed=!0),i}}),function(){function e(e,t){e.DEFMETHOD("optimize",function(e){var r=this;if(r._optimized)return r;if(e.has_directive("use asm"))return r;var n=t(r,e);return n._optimized=!0,n})}function t(e){if(!(e instanceof AST_SymbolRef))return!1;for(var t=e.definition().orig,r=t.length;--r>=0;)if(t[r]instanceof AST_SymbolConst)return!0}function r(e,t){for(var r,n=0;(r=e.parent(n++))&&!(r instanceof AST_Scope);)if(r instanceof AST_Catch){r=r.argname.definition().scope;break}return r.find_variable(t)}function n(e,t,r){return r||(r={}),t&&(r.start||(r.start=t.start),r.end||(r.end=t.end)),new e(r)}function i(e,t){switch(typeof e){case"string":return n(AST_String,t,{value:e});case"number":return isNaN(e)?n(AST_NaN,t):isFinite(e)?0>1/e?n(AST_UnaryPrefix,t,{operator:"-",expression:n(AST_Number,t,{value:-e})}):n(AST_Number,t,{value:e}):0>e?n(AST_UnaryPrefix,t,{operator:"-",expression:n(AST_Infinity,t)}):n(AST_Infinity,t);case"boolean":return n(e?AST_True:AST_False,t);case"undefined":return n(AST_Undefined,t);default:if(null===e)return n(AST_Null,t,{value:null});if(e instanceof RegExp)return n(AST_RegExp,t,{value:e});throw new Error(string_template("Can't handle constant of type: {type}",{type:typeof e}))}}function a(e,t,r){return e instanceof AST_UnaryPrefix&&"delete"==e.operator||e instanceof AST_Call&&e.expression===t&&(r instanceof AST_PropAccess||r instanceof AST_SymbolRef&&"eval"==r.name)?n(AST_Seq,t,{car:n(AST_Number,t,{value:0}),cdr:r}):r}function o(e){if(null===e)return[];if(e instanceof AST_BlockStatement)return e.body;if(e instanceof AST_EmptyStatement)return[];if(e instanceof AST_Statement)return[e];throw new Error("Can't convert thing to statement array")}function s(e){return null===e?!0:e instanceof AST_EmptyStatement?!0:e instanceof AST_BlockStatement?0==e.body.length:!1}function u(e){return e instanceof AST_Switch?e:(e instanceof AST_For||e instanceof AST_ForIn||e instanceof AST_DWLoop)&&e.body instanceof AST_BlockStatement?e.body:e}function l(e){return e instanceof AST_Call&&!(e instanceof AST_New)?e.expression instanceof AST_Function||l(e.expression):!1}function c(e,t){function s(e,t){function C(e,t){return e instanceof AST_SymbolRef&&m(e,t)}function O(s,u,l){if(C(s,u))return s;var p=a(u,s,w.value);return w.value=null,h.splice(b,1),0===h.length&&(e[f]=n(AST_EmptyStatement,i),o=!0),c.reset_opt_flags(t),t.info("Collapsing "+(l?"constant":"variable")+" "+x+" [{file}:{line},{col}]",s.start),r=!0,p}for(var i=t.self(),o=!1,u=t.option("toplevel"),l=e.length;--l>=0;){var c=e[l];if(!(c instanceof AST_Definitions)){if([c,c.body,c.alternative,c.bcatch,c.bfinally].forEach(function(e){e&&e.body&&s(e.body,t)}),0>=l)break;var f=l-1,p=e[f];if(p instanceof AST_Definitions){var h=p.definitions;if(null!=h)for(var d={},v=!1,g=!1,y={},b=h.length;--b>=0;){var w=h[b];if(null==w.value)break;var x=w.name.name;if(!x||!x.length)break;if(x in d)break;d[x]=!0;var S=i.find_variable&&i.find_variable(x);if(S&&S.references&&1===S.references.length&&"arguments"!=x&&(u||!S.global)){var k=S.references[0];if(k.scope.uses_eval||k.scope.uses_with)break;if(w.value.is_constant()){var _=new TreeTransformer(function(e){var t=_.parent();return t instanceof AST_IterationStatement&&(t.condition===e||t.init===e)?e:e===k?O(e,t,!0):void 0});c.transform(_)}else if(!(v|=g)){var E=w.value.has_side_effects(t);if(k.scope===i){var j=new TreeWalker(function(e){e instanceof AST_SymbolRef&&C(e,j.parent())&&(y[e.name]=g=!0)});w.value.walk(j);var A=!1,q=new TreeTransformer(function(e){function r(e,t){if(1===e.orig.length&&e.orig[0]instanceof AST_SymbolDefun)return!0;if(e.scope!==t)return!1;for(var r=e.references,n=0,i=r.length;i>n;n++)if(r[n].scope!==t)return!1;return!0}if(A)return e;var t=q.parent();return e instanceof AST_Lambda||e instanceof AST_Try||e instanceof AST_With||e instanceof AST_Case||e instanceof AST_IterationStatement||t instanceof AST_If&&e!==t.condition||t instanceof AST_Conditional&&e!==t.condition||e instanceof AST_SymbolRef&&E&&!r(e.definition(),i)||t instanceof AST_Binary&&("&&"==t.operator||"||"==t.operator)&&e===t.right||t instanceof AST_Switch&&e!==t.expression?(v=A=!0,e):void 0},function(e){return A?e:e===k?(A=!0,O(e,q.parent(),!1)):(v|=e.has_side_effects(t))?(A=!0,e):g&&e instanceof AST_SymbolRef&&e.name in y?(v=!0,A=!0,e):void 0});c.transform(q)}else v|=E}}else v=!0}}}}if(o)for(var T=e.length;--T>=0;)e.length>1&&e[T]instanceof AST_EmptyStatement&&e.splice(T,1);return e}function l(e){function r(e){return/@ngInject/.test(e.value)}function i(e){return e.argnames.map(function(e){return n(AST_String,e,{value:e.name})})}function a(e,t){return n(AST_Array,e,{elements:t})}function o(e,t){return n(AST_SimpleStatement,e,{body:n(AST_Assign,e,{operator:"=",left:n(AST_Dot,t,{expression:n(AST_SymbolRef,t,t),property:"$inject"}),right:a(e,i(e))})})}function s(e){e&&e.args&&(e.args.forEach(function(e,t,n){var o=e.start.comments_before;e instanceof AST_Lambda&&o.length&&r(o[0])&&(n[t]=a(e,i(e).concat(e)))}),e.expression&&e.expression.expression&&s(e.expression.expression))}return e.reduce(function(e,n){if(e.push(n),n.body&&n.body.args)s(n.body);else{var i=n.start,a=i.comments_before;if(a&&a.length>0){var u=a.pop();r(u)&&(n instanceof AST_Defun?e.push(o(n,n.name)):n instanceof AST_Definitions?n.definitions.forEach(function(t){t.value&&t.value instanceof AST_Lambda&&e.push(o(t.value,t.name))}):t.warn("Unknown statement marked with @ngInject [{file}:{line},{col}]",i))}}return e},[])}function c(e){var t=[];return e.reduce(function(e,n){return n instanceof AST_BlockStatement?(r=!0,e.push.apply(e,c(n.body))):n instanceof AST_EmptyStatement?r=!0:n instanceof AST_Directive?t.indexOf(n.value)<0?(e.push(n),t.push(n.value)):r=!0:e.push(n),e},[])}function h(e,t){function y(e){for(var t=0,r=e.length;--r>=0;){var n=e[r];if(n instanceof AST_If&&n.body instanceof AST_Return&&++t>1)return!0}return!1}var i=t.self(),a=y(e),s=i instanceof AST_Lambda,l=[];e:for(var c=e.length;--c>=0;){var p=e[c];switch(!0){case s&&p instanceof AST_Return&&!p.value&&0==l.length:r=!0;continue e;case p instanceof AST_If:if(p.body instanceof AST_Return){if((s&&0==l.length||l[0]instanceof AST_Return&&!l[0].value)&&!p.body.value&&!p.alternative){r=!0;var h=n(AST_SimpleStatement,p.condition,{body:p.condition});l.unshift(h);continue e}if(l[0]instanceof AST_Return&&p.body.value&&l[0].value&&!p.alternative){r=!0,p=p.clone(),p.alternative=l[0],l[0]=p.transform(t);continue e}if(a&&(0==l.length||l[0]instanceof AST_Return)&&p.body.value&&!p.alternative&&s){r=!0,p=p.clone(),p.alternative=l[0]||n(AST_Return,p,{value:null}),l[0]=p.transform(t);continue e}if(!p.body.value&&s){r=!0,p=p.clone(),p.condition=p.condition.negate(t);var d=o(p.alternative).concat(l),m=f(d);p.body=n(AST_BlockStatement,p,{body:d}),p.alternative=null,l=m.concat([p.transform(t)]);continue e}if(t.option("sequences")&&c>0&&e[c-1]instanceof AST_If&&e[c-1].body instanceof AST_Return&&1==l.length&&s&&l[0]instanceof AST_SimpleStatement&&!p.alternative){r=!0,l.push(n(AST_Return,l[0],{value:null}).transform(t)),l.unshift(p);continue e}}var v=b(p.body),g=v instanceof AST_LoopControl?t.loopcontrol_target(v):null;if(v&&(v instanceof AST_Return&&!v.value&&s||v instanceof AST_Continue&&i===u(g)||v instanceof AST_Break&&g instanceof AST_BlockStatement&&i===g)){v.label&&remove(v.label.thedef.references,v),r=!0;var d=o(p.body).slice(0,-1);p=p.clone(),p.condition=p.condition.negate(t),p.body=n(AST_BlockStatement,p,{body:o(p.alternative).concat(l)}),p.alternative=n(AST_BlockStatement,p,{body:d}),l=[p.transform(t)];continue e}var v=b(p.alternative),g=v instanceof AST_LoopControl?t.loopcontrol_target(v):null;if(v&&(v instanceof AST_Return&&!v.value&&s||v instanceof AST_Continue&&i===u(g)||v instanceof AST_Break&&g instanceof AST_BlockStatement&&i===g)){v.label&&remove(v.label.thedef.references,v),r=!0,p=p.clone(),p.body=n(AST_BlockStatement,p.body,{body:o(p.body).concat(l)}),p.alternative=n(AST_BlockStatement,p.alternative,{body:o(p.alternative).slice(0,-1)}),l=[p.transform(t)];continue e}l.unshift(p);break;default:l.unshift(p)}}return l}function d(e,t){var n=!1,i=e.length,a=t.self();return e=e.reduce(function(e,r){if(n)p(t,r,e);else{if(r instanceof AST_LoopControl){var i=t.loopcontrol_target(r);r instanceof AST_Break&&!(i instanceof AST_IterationStatement)&&u(i)===a||r instanceof AST_Continue&&u(i)===a?r.label&&remove(r.label.thedef.references,r):e.push(r)}else e.push(r);b(r)&&(n=!0)}return e},[]),r=e.length!=i,e}function v(e,t){function o(){i=AST_Seq.from_array(i),i&&a.push(n(AST_SimpleStatement,i,{body:i})),i=[]}if(e.length<2)return e;var i=[],a=[];return e.forEach(function(e){if(e instanceof AST_SimpleStatement){g(i)>=t.sequences_limit&&o();var r=e.body;i.length>0&&(r=r.drop_side_effect_free(t)),r&&i.push(r)}else o(),a.push(e)}),o(),a=y(a,t),r=a.length!=e.length,a}function g(e){for(var t=0,r=0;r<e.length;++r){var n=e[r];n instanceof AST_Seq?t+=n.len():t++}return t}function y(e,t){function r(e){i.pop();var r=a.body;return r instanceof AST_Seq?r.add(e):r=AST_Seq.cons(r,e),r.transform(t)}var i=[],a=null;return e.forEach(function(e){if(a)if(e instanceof AST_For){var o={};try{a.body.walk(new TreeWalker(function(e){if(e instanceof AST_Binary&&"in"==e.operator)throw o})),!e.init||e.init instanceof AST_Definitions?e.init||(e.init=a.body.drop_side_effect_free(t),i.pop()):e.init=r(e.init)}catch(s){if(s!==o)throw s}}else e instanceof AST_If?e.condition=r(e.condition):e instanceof AST_With?e.expression=r(e.expression):e instanceof AST_Exit&&e.value?e.value=r(e.value):e instanceof AST_Exit?e.value=r(n(AST_Undefined,e).transform(t)):e instanceof AST_Switch&&(e.expression=r(e.expression));i.push(e),a=e instanceof AST_SimpleStatement?e:null}),i}function w(e,t){var n=null;return e.reduce(function(e,t){return t instanceof AST_Definitions&&n&&n.TYPE==t.TYPE?(n.definitions=n.definitions.concat(t.definitions),r=!0):t instanceof AST_For&&n instanceof AST_Var&&(!t.init||t.init.TYPE==n.TYPE)?(r=!0,e.pop(),t.init?t.init.definitions=n.definitions.concat(t.init.definitions):t.init=n,e.push(t),n=t):(n=t,e.push(t)),e},[])}var r,i=10;do r=!1,t.option("angular")&&(e=l(e)),e=c(e),t.option("dead_code")&&(e=d(e,t)),t.option("if_return")&&(e=h(e,t)),t.sequences_limit>0&&(e=v(e,t)),t.option("join_vars")&&(e=w(e,t)),t.option("collapse_vars")&&(e=s(e,t));while(r&&i-->0);return e}function f(e){for(var t=[],r=e.length-1;r>=0;--r){var n=e[r];n instanceof AST_Defun&&(e.splice(r,1),t.unshift(n))}return t}function p(e,t,r){t instanceof AST_Defun||e.warn("Dropping unreachable code [{file}:{line},{col}]",t.start),t.walk(new TreeWalker(function(t){return t instanceof AST_Definitions?(e.warn("Declarations in unreachable code! [{file}:{line},{col}]",t.start),t.remove_initializers(),r.push(t),!0):t instanceof AST_Defun?(r.push(t),!0):t instanceof AST_Scope?!0:void 0}))}function h(e,t){return e.is_undefined||e instanceof AST_Undefined||e instanceof AST_UnaryPrefix&&"void"==e.operator&&!e.expression.has_side_effects(t)}function m(e,t){return t instanceof AST_Unary&&d(t.operator)?t.expression:t instanceof AST_Assign&&t.left===e?e:void 0}function v(e,t){return e.print_to_string().length>t.print_to_string().length?t:e}function g(e,t){return v(n(AST_SimpleStatement,e,{body:e}),n(AST_SimpleStatement,t,{body:t})).body}function y(e,t,r){return(first_in_statement(e)?g:v)(t,r)}function b(e){return e&&e.aborts()}function w(e,t){function r(r){r=o(r),e.body instanceof AST_BlockStatement?(e.body=e.body.clone(),e.body.body=r.concat(e.body.body.slice(1)),e.body=e.body.transform(t)):e.body=n(AST_BlockStatement,e.body,{body:r}).transform(t),w(e,t)}var i=e.body instanceof AST_BlockStatement?e.body.body[0]:e.body;i instanceof AST_If&&(i.body instanceof AST_Break&&t.loopcontrol_target(i.body)===t.self()?(e.condition?e.condition=n(AST_Binary,e.condition,{left:e.condition,operator:"&&",right:i.condition.negate(t)}):e.condition=i.condition.negate(t),r(i.alternative)):i.alternative instanceof AST_Break&&t.loopcontrol_target(i.alternative)===t.self()&&(e.condition?e.condition=n(AST_Binary,e.condition,{left:e.condition,operator:"&&",right:i.condition}):e.condition=i.condition,r(i.body)))}function S(e,t){return e instanceof AST_SymbolRef||e.TYPE===t.TYPE}function E(e,t){return t.option("booleans")&&t.in_boolean_context()?y(t,e,n(AST_Seq,e,{car:e,cdr:n(AST_True,e)}).optimize(t)):e}e(AST_Node,function(e,t){return e}),AST_Node.DEFMETHOD("equivalent_to",function(e){return this.TYPE==e.TYPE&&this.print_to_string()==e.print_to_string()}),AST_Node.DEFMETHOD("process_expression",function(e,t){var r=this,i=new TreeTransformer(function(a){if(e&&a instanceof AST_SimpleStatement)return n(AST_Return,a,{value:a.body});if(!e&&a instanceof AST_Return){if(t){var o=a.value&&a.value.drop_side_effect_free(t,!0);return o?n(AST_SimpleStatement,a,{body:o}):n(AST_EmptyStatement,a)}return n(AST_SimpleStatement,a,{body:a.value||n(AST_UnaryPrefix,a,{operator:"void",expression:n(AST_Number,a,{value:0})})})}if(a instanceof AST_Lambda&&a!==r)return a;if(a instanceof AST_Block){var s=a.body.length-1;s>=0&&(a.body[s]=a.body[s].transform(i))}return a instanceof AST_If&&(a.body=a.body.transform(i),a.alternative&&(a.alternative=a.alternative.transform(i))),a instanceof AST_With&&(a.body=a.body.transform(i)),a});return r.transform(i)}),AST_Node.DEFMETHOD("reset_opt_flags",function(e,t){function u(e,t){a[e.id]=t}function l(e){if(a[e.id]){if(null==e.fixed){var t=e.orig[0];if(t instanceof AST_SymbolFunarg||"arguments"==t.name)return!1;e.fixed=n(AST_Undefined,t)}return!0}}function c(){a=Object.create(a)}function f(){a=Object.getPrototypeOf(a)}function p(e){e.escaped=!1,e.scope.uses_eval?e.fixed=!1:i||!e.global||e.orig[0]instanceof AST_SymbolConst?e.fixed=void 0:e.fixed=!1,e.references=[],e.should_replace=void 0}function h(e,t,r){var n=s.parent(t);return m(e,n)||!r&&n instanceof AST_Call&&n.expression===e?!0:n instanceof AST_PropAccess&&n.expression===e?!r&&h(n,t+1):void 0}var r=t&&e.option("reduce_vars"),i=e.option("toplevel"),a=Object.create(null),o=new TreeWalker(function(e){if(e instanceof AST_Symbol){var t=e.definition();e instanceof AST_SymbolRef&&t.references.push(e),t.fixed=!1}}),s=new TreeWalker(function(e,t){if(e._squeezed=!1,e._optimized=!1,r){if(e instanceof AST_Toplevel&&e.globals.each(p),e instanceof AST_Scope&&e.variables.each(p),e instanceof AST_SymbolRef){var d=e.definition();if(d.references.push(e),void 0===d.fixed||!l(d)||h(e,0,e.fixed_value()instanceof AST_Lambda))d.fixed=!1;else{var m=s.parent();(m instanceof AST_Assign&&"="==m.operator&&e===m.right||m instanceof AST_Call&&e!==m.expression||m instanceof AST_Return&&e===m.value&&e.scope!==d.scope||m instanceof AST_VarDef&&e===m.value)&&(d.escaped=!0)}}if(e instanceof AST_SymbolCatch&&(e.definition().fixed=!1),e instanceof AST_VarDef){var d=e.name.definition();if(null==d.fixed)return e.value?(d.fixed=function(){return e.value},u(d,!1),t()):d.fixed=null,u(d,!0),!0;e.value&&(d.fixed=!1)}if(e instanceof AST_Defun){var d=e.name.definition();!i&&d.global||l(d)?d.fixed=!1:(d.fixed=e,u(d,!0));var v=a;return a=Object.create(null),t(),a=v,!0}if(e instanceof AST_Function){c();var g;return!e.name&&(g=s.parent())instanceof AST_Call&&g.expression===e&&e.argnames.forEach(function(t,r){var i=t.definition();e.uses_arguments||void 0!==i.fixed?i.fixed=!1:(i.fixed=function(){return g.args[r]||n(AST_Undefined,g)},u(i,!0))}),t(),f(),!0}if(e instanceof AST_Accessor){var v=a;return a=Object.create(null),t(),a=v,!0}if(e instanceof AST_Binary&&("&&"==e.operator||"||"==e.operator))return e.left.walk(s),c(),e.right.walk(s),f(),!0;if(e instanceof AST_Conditional)return e.condition.walk(s),c(),e.consequent.walk(s),f(),c(),e.alternative.walk(s),f(),!0;if(e instanceof AST_If||e instanceof AST_DWLoop)return e.condition.walk(s),c(),e.body.walk(s),f(),e.alternative&&(c(),e.alternative.walk(s),f()),!0;if(e instanceof AST_LabeledStatement)return c(),e.body.walk(s),f(),!0;if(e instanceof AST_For)return e.init&&e.init.walk(s),c(),e.condition&&e.condition.walk(s),e.body.walk(s),e.step&&e.step.walk(s),f(),!0;if(e instanceof AST_ForIn)return e.init.walk(o),e.object.walk(s),c(),e.body.walk(s),f(),!0;if(e instanceof AST_Try)return c(),walk_body(e,s),f(),e.bcatch&&(c(),e.bcatch.walk(s),f()),e.bfinally&&e.bfinally.walk(s),!0;if(e instanceof AST_SwitchBranch)return c(),t(),f(),!0}});this.walk(s)}),AST_SymbolRef.DEFMETHOD("fixed_value",function(){var e=this.definition().fixed;return!e||e instanceof AST_Node?e:e()}),function(e){function t(e){return/strict/.test(e)}AST_Node.DEFMETHOD("may_throw_on_access",function(e){var t=e.option("pure_getters");return!t||this._throw_on_access(t)}),e(AST_Node,t),e(AST_Null,return_true),e(AST_Undefined,return_true),e(AST_Constant,return_false),e(AST_Array,return_false),e(AST_Object,function(e){if(!t(e))return!1;for(var r=this.properties.length;--r>=0;)if(this.properties[r].value instanceof AST_Accessor)return!0;return!1}),e(AST_Function,return_false),e(AST_UnaryPostfix,return_false),e(AST_UnaryPrefix,function(){return"void"==this.operator}),e(AST_Binary,function(e){switch(this.operator){case"&&":return this.left._throw_on_access(e);case"||":return this.left._throw_on_access(e)&&this.right._throw_on_access(e);default:return!1}}),e(AST_Assign,function(e){return"="==this.operator&&this.right._throw_on_access(e)}),e(AST_Conditional,function(e){return this.consequent._throw_on_access(e)||this.alternative._throw_on_access(e)}),e(AST_Seq,function(e){return this.cdr._throw_on_access(e)}),e(AST_SymbolRef,function(e){if(this.is_undefined)return!0;if(!t(e))return!1;var r=this.fixed_value();return!r||r._throw_on_access(e)})}(function(e,t){e.DEFMETHOD("_throw_on_access",t)}),function(e){var t=["!","delete"],r=["in","instanceof","==","!=","===","!==","<","<=",">=",">"];e(AST_Node,return_false),e(AST_UnaryPrefix,function(){return member(this.operator,t)}),e(AST_Binary,function(){return member(this.operator,r)||("&&"==this.operator||"||"==this.operator)&&this.left.is_boolean()&&this.right.is_boolean()}),e(AST_Conditional,function(){return this.consequent.is_boolean()&&this.alternative.is_boolean()}),e(AST_Assign,function(){return"="==this.operator&&this.right.is_boolean()}),e(AST_Seq,function(){return this.cdr.is_boolean()}),e(AST_True,return_true),e(AST_False,return_true)}(function(e,t){e.DEFMETHOD("is_boolean",t)}),function(e){e(AST_Node,return_false),e(AST_Number,return_true);var t=makePredicate("+ - ~ ++ --");e(AST_Unary,function(){return t(this.operator)});var r=makePredicate("- * / % & | ^ << >> >>>");e(AST_Binary,function(e){return r(this.operator)||"+"==this.operator&&this.left.is_number(e)&&this.right.is_number(e)}),e(AST_Assign,function(e){return r(this.operator.slice(0,-1))||"="==this.operator&&this.right.is_number(e)}),e(AST_Seq,function(e){return this.cdr.is_number(e)}),e(AST_Conditional,function(e){return this.consequent.is_number(e)&&this.alternative.is_number(e)})}(function(e,t){e.DEFMETHOD("is_number",t)}),function(e){e(AST_Node,return_false),e(AST_String,return_true),e(AST_UnaryPrefix,function(){return"typeof"==this.operator}),e(AST_Binary,function(e){return"+"==this.operator&&(this.left.is_string(e)||this.right.is_string(e))}),e(AST_Assign,function(e){return("="==this.operator||"+="==this.operator)&&this.right.is_string(e)}),e(AST_Seq,function(e){return this.cdr.is_string(e)}),e(AST_Conditional,function(e){return this.consequent.is_string(e)&&this.alternative.is_string(e)})}(function(e,t){e.DEFMETHOD("is_string",t)});var d=makePredicate("delete ++ --");!function(e){function t(e,r){if(e instanceof AST_Node)return n(e.CTOR,r,e);if(Array.isArray(e))return n(AST_Array,r,{elements:e.map(function(e){return t(e,r)})});if(e&&"object"==typeof e){var a=[];for(var o in e)a.push(n(AST_ObjectKeyVal,r,{key:o,value:t(e[o],r)}));return n(AST_Object,r,{properties:a})}return i(e,r)}AST_Node.DEFMETHOD("resolve_defines",function(e){if(e.option("global_defs")){var t=this._find_defs(e,"");if(t){var r,n=this,i=0;do r=n,n=e.parent(i++);while(n instanceof AST_PropAccess&&n.expression===r);if(!m(r,n))return t;e.warn("global_defs "+this.print_to_string()+" redefined [{file}:{line},{col}]",this.start)}}}),e(AST_Node,noop),e(AST_Dot,function(e,t){return this.expression._find_defs(e,"."+this.property+t)}),e(AST_SymbolRef,function(e,r){if(this.global()){var n,i=e.option("global_defs");if(i&&HOP(i,n=this.name+r)){var a=t(i[n],this),o=e.find_parent(AST_Toplevel);return a.walk(new TreeWalker(function(e){e instanceof AST_SymbolRef&&(e.scope=o,e.thedef=o.def_global(e))})),a}}})}(function(e,t){e.DEFMETHOD("_find_defs",t)}),function(e){function r(e,t){if(!t)throw new Error("Compressor must be passed");return e._eval(t)}AST_Node.DEFMETHOD("evaluate",function(t){if(!t.option("evaluate"))return this;try{var r=this._eval(t);return!r||r instanceof RegExp||"object"!=typeof r?r:this}catch(n){if(n!==e)throw n;return this}});var t=makePredicate("! ~ - + void");AST_Node.DEFMETHOD("is_constant",function(){return this instanceof AST_Constant?!(this instanceof AST_RegExp):this instanceof AST_UnaryPrefix&&this.expression instanceof AST_Constant&&t(this.operator)}),AST_Node.DEFMETHOD("constant_value",function(e){if(this instanceof AST_Constant&&!(this instanceof AST_RegExp))return this.value;if(this instanceof AST_UnaryPrefix&&this.expression instanceof AST_Constant)switch(this.operator){case"!":return!this.expression.value;case"~":return~this.expression.value;case"-":return-this.expression.value;case"+":return+this.expression.value;default:throw new Error(string_template("Cannot evaluate unary expression {value}",{value:this.print_to_string()}))}var t=this.evaluate(e);if(t!==this)return t;throw new Error(string_template("Cannot evaluate constant [{file}:{line},{col}]",this.start))}),e(AST_Statement,function(){throw new Error(string_template("Cannot evaluate a statement [{file}:{line},{col}]",this.start))}),e(AST_Lambda,function(){throw e}),e(AST_Node,function(){throw e}),e(AST_Constant,function(){return this.getValue()}),e(AST_Array,function(t){if(t.option("unsafe"))return this.elements.map(function(e){return r(e,t)});throw e}),e(AST_Object,function(t){if(t.option("unsafe")){for(var n={},i=0,a=this.properties.length;a>i;i++){var o=this.properties[i],s=o.key;if(s instanceof AST_Symbol?s=s.name:s instanceof AST_Node&&(s=r(s,t)),"function"==typeof Object.prototype[s])throw e;n[s]=r(o.value,t)}return n}throw e}),e(AST_UnaryPrefix,function(t){var n=this.expression;switch(this.operator){case"!":return!r(n,t);case"typeof":if(n instanceof AST_Function)return"function";if(n=r(n,t),n instanceof RegExp)throw e;return typeof n;case"void":return void r(n,t);case"~":return~r(n,t);case"-":return-r(n,t);case"+":return+r(n,t)}throw e}),e(AST_Binary,function(t){var a,n=this.left,i=this.right;switch(this.operator){case"&&":a=r(n,t)&&r(i,t);break;case"||":a=r(n,t)||r(i,t);break;case"|":a=r(n,t)|r(i,t);break;case"&":a=r(n,t)&r(i,t);break;case"^":a=r(n,t)^r(i,t);break;case"+":a=r(n,t)+r(i,t);break;case"*":a=r(n,t)*r(i,t);break;case"/":a=r(n,t)/r(i,t);break;case"%":a=r(n,t)%r(i,t);break;case"-":a=r(n,t)-r(i,t);break;case"<<":a=r(n,t)<<r(i,t);break;case">>":a=r(n,t)>>r(i,t);break;case">>>":a=r(n,t)>>>r(i,t);break;case"==":a=r(n,t)==r(i,t);break;case"===":a=r(n,t)===r(i,t);break;case"!=":a=r(n,t)!=r(i,t);break;case"!==":a=r(n,t)!==r(i,t);break;case"<":a=r(n,t)<r(i,t);break;case"<=":a=r(n,t)<=r(i,t);break;case">":a=r(n,t)>r(i,t);break;case">=":a=r(n,t)>=r(i,t);break;default:throw e}if(isNaN(a)&&t.find_parent(AST_With))throw e;return a}),e(AST_Conditional,function(e){return r(this.condition,e)?r(this.consequent,e):r(this.alternative,e)}),e(AST_SymbolRef,function(t){if(!t.option("reduce_vars")||this._evaluating)throw e;this._evaluating=!0;try{var n=this.fixed_value();if(!n)throw e;var i=r(n,t);if(HOP(n,"_eval")||(n._eval=function(){return i}),i&&"object"==typeof i&&this.definition().escaped)throw e;return i}finally{this._evaluating=!1}}),e(AST_PropAccess,function(t){if(t.option("unsafe")){var n=this.property;n instanceof AST_Node&&(n=r(n,t));var i=r(this.expression,t);if(i&&HOP(i,n))return i[n]}throw e})}(function(e,t){e.DEFMETHOD("_eval",t)}),function(e){function t(e){return n(AST_UnaryPrefix,e,{operator:"!",expression:e})}function r(e,r,i){var a=t(e);if(i){var o=n(AST_SimpleStatement,r,{body:r});return v(a,o)===o?r:a}return v(a,r)}e(AST_Node,function(){return t(this)}),e(AST_Statement,function(){throw new Error("Cannot negate a statement")}),e(AST_Function,function(){return t(this)}),e(AST_UnaryPrefix,function(){return"!"==this.operator?this.expression:t(this)}),e(AST_Seq,function(e){var t=this.clone();return t.cdr=t.cdr.negate(e),t}),e(AST_Conditional,function(e,t){var n=this.clone();return n.consequent=n.consequent.negate(e),n.alternative=n.alternative.negate(e),r(this,n,t)}),e(AST_Binary,function(e,n){var i=this.clone(),a=this.operator;if(e.option("unsafe_comps"))switch(a){case"<=":return i.operator=">",i;case"<":return i.operator=">=",i;case">=":return i.operator="<",i;case">":return i.operator="<=",i}switch(a){case"==":return i.operator="!=",i;case"!=":return i.operator="==",i;case"===":return i.operator="!==",i;case"!==":return i.operator="===",i;case"&&":return i.operator="||",i.left=i.left.negate(e,n),i.right=i.right.negate(e),r(this,i,n);case"||":return i.operator="&&",i.left=i.left.negate(e,n),i.right=i.right.negate(e),r(this,i,n)}return t(this)})}(function(e,t){e.DEFMETHOD("negate",function(e,r){return t.call(this,e,r)})}),AST_Call.DEFMETHOD("has_pure_annotation",function(e){if(!e.option("side_effects"))return!1;if(void 0!==this.pure)return this.pure;var r,n,t=!1;return this.start&&(r=this.start.comments_before)&&r.length&&/[@#]__PURE__/.test((n=r[r.length-1]).value)&&(t=n),this.pure=t}),function(e){function t(e,t){for(var r=e.length;--r>=0;)if(e[r].has_side_effects(t))return!0;return!1}e(AST_Node,return_true),e(AST_EmptyStatement,return_false),e(AST_Constant,return_false),e(AST_This,return_false),e(AST_Call,function(e){if(!this.has_pure_annotation(e)&&e.pure_funcs(this))return!0;for(var t=this.args.length;--t>=0;)if(this.args[t].has_side_effects(e))return!0;return!1}),e(AST_Block,function(e){return t(this.body,e)}),e(AST_Switch,function(e){return this.expression.has_side_effects(e)||t(this.body,e)}),e(AST_Case,function(e){return this.expression.has_side_effects(e)||t(this.body,e)}),e(AST_Try,function(e){return t(this.body,e)||this.bcatch&&this.bcatch.has_side_effects(e)||this.bfinally&&this.bfinally.has_side_effects(e)}),e(AST_If,function(e){return this.condition.has_side_effects(e)||this.body&&this.body.has_side_effects(e)||this.alternative&&this.alternative.has_side_effects(e)}),e(AST_LabeledStatement,function(e){return this.body.has_side_effects(e)}),e(AST_SimpleStatement,function(e){return this.body.has_side_effects(e)}),e(AST_Defun,return_true),e(AST_Function,return_false),e(AST_Binary,function(e){return this.left.has_side_effects(e)||this.right.has_side_effects(e)}),e(AST_Assign,return_true),e(AST_Conditional,function(e){return this.condition.has_side_effects(e)||this.consequent.has_side_effects(e)||this.alternative.has_side_effects(e)}),e(AST_Unary,function(e){return d(this.operator)||this.expression.has_side_effects(e)}),e(AST_SymbolRef,function(e){return this.undeclared()}),e(AST_Object,function(e){return t(this.properties,e)}),e(AST_ObjectProperty,function(e){return this.value.has_side_effects(e)}),e(AST_Array,function(e){return t(this.elements,e)}),e(AST_Dot,function(e){return this.expression.may_throw_on_access(e)||this.expression.has_side_effects(e)}),e(AST_Sub,function(e){return this.expression.may_throw_on_access(e)||this.expression.has_side_effects(e)||this.property.has_side_effects(e)}),e(AST_Seq,function(e){return this.car.has_side_effects(e)||this.cdr.has_side_effects(e)})}(function(e,t){e.DEFMETHOD("has_side_effects",t)}),function(e){function t(){var e=this.body.length;return e>0&&b(this.body[e-1])}e(AST_Statement,return_null),e(AST_Jump,return_this),e(AST_BlockStatement,t),e(AST_SwitchBranch,t),e(AST_If,function(){return this.alternative&&b(this.body)&&b(this.alternative)&&this})}(function(e,t){e.DEFMETHOD("aborts",t)}),e(AST_Directive,function(e,t){return t.has_directive(e.value)!==e?n(AST_EmptyStatement,e):e}),e(AST_Debugger,function(e,t){return t.option("drop_debugger")?n(AST_EmptyStatement,e):e}),e(AST_LabeledStatement,function(e,t){return e.body instanceof AST_Break&&t.loopcontrol_target(e.body)===e.body?n(AST_EmptyStatement,e):0==e.label.references.length?e.body:e}),e(AST_Block,function(e,t){return e.body=c(e.body,t),e}),e(AST_BlockStatement,function(e,t){switch(e.body=c(e.body,t),e.body.length){case 1:return e.body[0];case 0:return n(AST_EmptyStatement,e)}return e}),AST_Scope.DEFMETHOD("drop_unused",function(e){var r=this;if(e.has_directive("use asm"))return r;var i=e.option("toplevel");if(e.option("unused")&&(!(r instanceof AST_Toplevel)||i)&&!r.uses_eval&&!r.uses_with){var o=!/keep_assign/.test(e.option("unused")),u=/funcs/.test(i),l=/vars/.test(i);r instanceof AST_Toplevel&&1!=i||(u=l=!0);var c=[],f=Object.create(null);r instanceof AST_Toplevel&&e.top_retain&&r.variables.each(function(t){!e.top_retain(t)||t.id in f||(f[t.id]=!0,c.push(t))});var p=new Dictionary,h=this,d=new TreeWalker(function(n,i){if(n!==r){if(n instanceof AST_Defun){if(!u&&h===r){var a=n.name.definition();a.id in f||(f[a.id]=!0,c.push(a))}return p.add(n.name.name,n),!0}if(n instanceof AST_Definitions&&h===r)return n.definitions.forEach(function(t){if(!l){var r=t.name.definition();r.id in f||(f[r.id]=!0,c.push(r))}t.value&&(p.add(t.name.name,t.value),t.value.has_side_effects(e)&&t.value.walk(d))}),!0;if(o&&n instanceof AST_Assign&&"="==n.operator&&n.left instanceof AST_SymbolRef&&!t(n.left)&&h===r)return n.right.walk(d),!0;if(n instanceof AST_SymbolRef){var a=n.definition();return a.id in f||(f[a.id]=!0,c.push(a)),!0}if(n instanceof AST_Scope){var s=h;return h=n,i(),h=s,!0}}});r.walk(d);for(var m=0;m<c.length;++m)c[m].orig.forEach(function(e){
var t=p.get(e.name);t&&t.forEach(function(e){var t=new TreeWalker(function(e){if(e instanceof AST_SymbolRef){var t=e.definition();t.id in f||(f[t.id]=!0,c.push(t))}});e.walk(t)})});var v=new TreeTransformer(function(t,i,c){if(t instanceof AST_Function&&t.name&&!e.option("keep_fnames")){var p=t.name.definition();(!(p.id in f)||p.orig.length>1)&&(t.name=null)}if(t instanceof AST_Lambda&&!(t instanceof AST_Accessor))for(var h=!e.option("keep_fargs"),d=t.argnames,m=d.length;--m>=0;){var g=d[m];g.definition().id in f?h=!1:(g.__unused=!0,h&&(d.pop(),e[g.unreferenced()?"warn":"info"]("Dropping unused function argument {name} [{file}:{line},{col}]",{name:g.name,file:g.start.file,line:g.start.line,col:g.start.col})))}if(u&&t instanceof AST_Defun&&t!==r)return t.name.definition().id in f?t:(e[t.name.unreferenced()?"warn":"info"]("Dropping unused function {name} [{file}:{line},{col}]",{name:t.name.name,file:t.name.start.file,line:t.name.start.line,col:t.name.start.col}),n(AST_EmptyStatement,t));if(l&&t instanceof AST_Definitions&&!(v.parent()instanceof AST_ForIn&&v.parent().init===t)){var p=t.definitions.filter(function(t){t.value&&(t.value=t.value.transform(v));var r=t.name.definition();if(r.id in f)return!0;if(r.orig[0]instanceof AST_SymbolCatch)return t.value=t.value&&t.value.drop_side_effect_free(e),!0;var n={name:t.name.name,file:t.name.start.file,line:t.name.start.line,col:t.name.start.col};return t.value&&(t._unused_side_effects=t.value.drop_side_effect_free(e))?(e.warn("Side effects in initialization of unused variable {name} [{file}:{line},{col}]",n),!0):(e[t.name.unreferenced()?"warn":"info"]("Dropping unused variable {name} [{file}:{line},{col}]",n),!1)});p=mergeSort(p,function(e,t){return!e.value&&t.value?-1:!t.value&&e.value?1:0});for(var y=[],m=0;m<p.length;){var b=p[m];b._unused_side_effects?(y.push(b._unused_side_effects),p.splice(m,1)):(y.length>0&&(y.push(b.value),b.value=AST_Seq.from_array(y),y=[]),++m)}return y=y.length>0?n(AST_BlockStatement,t,{body:[n(AST_SimpleStatement,t,{body:AST_Seq.from_array(y)})]}):null,0!=p.length||y?0==p.length?c?MAP.splice(y.body):y:(t.definitions=p,y?(y.body.unshift(t),c?MAP.splice(y.body):y):t):n(AST_EmptyStatement,t)}if(l&&o&&t instanceof AST_Assign&&"="==t.operator&&t.left instanceof AST_SymbolRef){var p=t.left.definition();if(!(p.id in f)&&r.variables.get(p.name)===p)return a(v.parent(),t,t.right.transform(v))}if(t instanceof AST_For){if(i(t,this),t.init instanceof AST_BlockStatement){var w=t.init;return t.init=w.body.pop(),w.body.push(t),c?MAP.splice(w.body):w}return s(t.init)&&(t.init=null),t}if(t instanceof AST_LabeledStatement&&t.body instanceof AST_For){if(i(t,this),t.body instanceof AST_BlockStatement){var w=t.body;return t.body=w.body.pop(),w.body.push(t),c?MAP.splice(w.body):w}return t}return t instanceof AST_Scope&&t!==r?t:void 0});r.transform(v)}}),AST_Scope.DEFMETHOD("hoist_declarations",function(e){var t=this;if(e.has_directive("use asm"))return t;var r=e.option("hoist_funs"),i=e.option("hoist_vars");if(r||i){var a=[],o=[],s=new Dictionary,u=0,l=0;t.walk(new TreeWalker(function(e){return e instanceof AST_Scope&&e!==t?!0:e instanceof AST_Var?(++l,!0):void 0})),i=i&&l>1;var c=new TreeTransformer(function(l){if(l!==t){if(l instanceof AST_Directive)return a.push(l),n(AST_EmptyStatement,l);if(l instanceof AST_Defun&&r)return o.push(l),n(AST_EmptyStatement,l);if(l instanceof AST_Var&&i){l.definitions.forEach(function(e){s.set(e.name.name,e),++u});var f=l.to_assignments(e),p=c.parent();if(p instanceof AST_ForIn&&p.init===l){if(null==f){var h=l.definitions[0].name;return n(AST_SymbolRef,h,h)}return f}return p instanceof AST_For&&p.init===l?f:f?n(AST_SimpleStatement,l,{body:f}):n(AST_EmptyStatement,l)}if(l instanceof AST_Scope)return l}});if(t=t.transform(c),u>0){var f=[];if(s.each(function(e,r){t instanceof AST_Lambda&&find_if(function(t){return t.name==e.name.name},t.argnames)?s.del(r):(e=e.clone(),e.value=null,f.push(e),s.set(r,e))}),f.length>0){for(var p=0;p<t.body.length;){if(t.body[p]instanceof AST_SimpleStatement){var d,m,h=t.body[p].body;if(h instanceof AST_Assign&&"="==h.operator&&(d=h.left)instanceof AST_Symbol&&s.has(d.name)){var v=s.get(d.name);if(v.value)break;v.value=h.right,remove(f,v),f.push(v),t.body.splice(p,1);continue}if(h instanceof AST_Seq&&(m=h.car)instanceof AST_Assign&&"="==m.operator&&(d=m.left)instanceof AST_Symbol&&s.has(d.name)){var v=s.get(d.name);if(v.value)break;v.value=m.right,remove(f,v),f.push(v),t.body[p].body=h.cdr;continue}}if(t.body[p]instanceof AST_EmptyStatement)t.body.splice(p,1);else{if(!(t.body[p]instanceof AST_BlockStatement))break;var g=[p,1].concat(t.body[p].body);t.body.splice.apply(t.body,g)}}f=n(AST_Var,t,{definitions:f}),o.push(f)}}t.body=a.concat(o,t.body)}return t}),function(e){function t(e,t,r){for(var n=[],i=!1,a=0,o=e.length;o>a;a++){var s=e[a].drop_side_effect_free(t,r);i|=s!==e[a],s&&(n.push(s),r=!1)}return i?n.length?n:null:e}e(AST_Node,return_this),e(AST_Constant,return_null),e(AST_This,return_null),e(AST_Call,function(e,r){if(!this.has_pure_annotation(e)&&e.pure_funcs(this)){if(this.expression instanceof AST_Function&&(!this.expression.name||!this.expression.name.definition().references.length)){var n=this.clone();return n.expression=n.expression.process_expression(!1,e),n}return this}this.pure&&(e.warn("Dropping __PURE__ call [{file}:{line},{col}]",this.start),this.pure.value=this.pure.value.replace(/[@#]__PURE__/g," "));var i=t(this.args,e,r);return i&&AST_Seq.from_array(i)}),e(AST_Accessor,return_null),e(AST_Function,return_null),e(AST_Binary,function(e,t){var r=this.right.drop_side_effect_free(e);if(!r)return this.left.drop_side_effect_free(e,t);switch(this.operator){case"&&":case"||":if(r===this.right)return this;var i=this.clone();return i.right=r,i;default:var a=this.left.drop_side_effect_free(e,t);return a?n(AST_Seq,this,{car:a,cdr:r}):this.right.drop_side_effect_free(e,t)}}),e(AST_Assign,return_this),e(AST_Conditional,function(e){var t=this.consequent.drop_side_effect_free(e),r=this.alternative.drop_side_effect_free(e);if(t===this.consequent&&r===this.alternative)return this;if(!t)return r?n(AST_Binary,this,{operator:"||",left:this.condition,right:r}):this.condition.drop_side_effect_free(e);if(!r)return n(AST_Binary,this,{operator:"&&",left:this.condition,right:t});var i=this.clone();return i.consequent=t,i.alternative=r,i}),e(AST_Unary,function(e,t){if(d(this.operator))return this;if("typeof"==this.operator&&this.expression instanceof AST_SymbolRef)return null;var r=this.expression.drop_side_effect_free(e,t);return t&&this instanceof AST_UnaryPrefix&&l(r)?r===this.expression&&1===this.operator.length?this:n(AST_UnaryPrefix,this,{operator:1===this.operator.length?this.operator:"!",expression:r}):r}),e(AST_SymbolRef,function(){return this.undeclared()?this:null}),e(AST_Object,function(e,r){var n=t(this.properties,e,r);return n&&AST_Seq.from_array(n)}),e(AST_ObjectProperty,function(e,t){return this.value.drop_side_effect_free(e,t)}),e(AST_Array,function(e,r){var n=t(this.elements,e,r);return n&&AST_Seq.from_array(n)}),e(AST_Dot,function(e,t){return this.expression.may_throw_on_access(e)?this:this.expression.drop_side_effect_free(e,t)}),e(AST_Sub,function(e,t){if(this.expression.may_throw_on_access(e))return this;var r=this.expression.drop_side_effect_free(e,t);if(!r)return this.property.drop_side_effect_free(e,t);var i=this.property.drop_side_effect_free(e);return i?n(AST_Seq,this,{car:r,cdr:i}):r}),e(AST_Seq,function(e){var t=this.cdr.drop_side_effect_free(e);return t===this.cdr?this:t?n(AST_Seq,this,{car:this.car,cdr:t}):this.car})}(function(e,t){e.DEFMETHOD("drop_side_effect_free",t)}),e(AST_SimpleStatement,function(e,t){if(t.option("side_effects")){var r=e.body,i=r.drop_side_effect_free(t,!0);if(!i)return t.warn("Dropping side-effect-free statement [{file}:{line},{col}]",e.start),n(AST_EmptyStatement,e);if(i!==r)return n(AST_SimpleStatement,e,{body:i})}return e}),e(AST_DWLoop,function(e,t){if(!t.option("loops"))return e;var r=e.condition.evaluate(t);if(r!==e.condition){if(r)return n(AST_For,e,{body:e.body});if(t.option("dead_code")&&e instanceof AST_While){var i=[];return p(t,e.body,i),n(AST_BlockStatement,e,{body:i}).optimize(t)}if(e instanceof AST_Do){var a=!1,o=new TreeWalker(function(t){return t instanceof AST_Scope||a?!0:t instanceof AST_LoopControl&&o.loopcontrol_target(t)===e?a=!0:void 0}),s=t.parent();if((s instanceof AST_LabeledStatement?s:e).walk(o),!a)return e.body}}return e instanceof AST_While?n(AST_For,e,e).optimize(t):e}),e(AST_For,function(e,t){if(!t.option("loops"))return e;if(e.condition){var r=e.condition.evaluate(t);if(t.option("dead_code")&&!r){var a=[];return e.init instanceof AST_Statement?a.push(e.init):e.init&&a.push(n(AST_SimpleStatement,e.init,{body:e.init})),p(t,e.body,a),n(AST_BlockStatement,e,{body:a}).optimize(t)}r!==e.condition&&(r=i(r,e.condition).transform(t),e.condition=v(r,e.condition))}return w(e,t),e}),e(AST_If,function(e,t){if(s(e.alternative)&&(e.alternative=null),!t.option("conditionals"))return e;var r=e.condition.evaluate(t);if(r!==e.condition){if(r){if(t.warn("Condition always true [{file}:{line},{col}]",e.condition.start),t.option("dead_code")){var a=[];return e.alternative&&p(t,e.alternative,a),a.push(e.body),n(AST_BlockStatement,e,{body:a}).optimize(t)}}else if(t.warn("Condition always false [{file}:{line},{col}]",e.condition.start),t.option("dead_code")){var a=[];return p(t,e.body,a),e.alternative&&a.push(e.alternative),n(AST_BlockStatement,e,{body:a}).optimize(t)}r=i(r,e.condition).transform(t),e.condition=v(r,e.condition)}var o=e.condition.negate(t),u=e.condition.print_to_string().length,l=o.print_to_string().length,c=u>l;if(e.alternative&&c){c=!1,e.condition=o;var f=e.body;e.body=e.alternative||n(AST_EmptyStatement,e),e.alternative=f}if(s(e.body)&&s(e.alternative))return n(AST_SimpleStatement,e.condition,{body:e.condition.clone()}).optimize(t);if(e.body instanceof AST_SimpleStatement&&e.alternative instanceof AST_SimpleStatement)return n(AST_SimpleStatement,e,{body:n(AST_Conditional,e,{condition:e.condition,consequent:e.body.body,alternative:e.alternative.body})}).optimize(t);if(s(e.alternative)&&e.body instanceof AST_SimpleStatement)return u===l&&!c&&e.condition instanceof AST_Binary&&"||"==e.condition.operator&&(c=!0),c?n(AST_SimpleStatement,e,{body:n(AST_Binary,e,{operator:"||",left:o,right:e.body.body})}).optimize(t):n(AST_SimpleStatement,e,{body:n(AST_Binary,e,{operator:"&&",left:e.condition,right:e.body.body})}).optimize(t);if(e.body instanceof AST_EmptyStatement&&e.alternative instanceof AST_SimpleStatement)return n(AST_SimpleStatement,e,{body:n(AST_Binary,e,{operator:"||",left:e.condition,right:e.alternative.body})}).optimize(t);if(e.body instanceof AST_Exit&&e.alternative instanceof AST_Exit&&e.body.TYPE==e.alternative.TYPE)return n(e.body.CTOR,e,{value:n(AST_Conditional,e,{condition:e.condition,consequent:e.body.value||n(AST_Undefined,e.body),alternative:e.alternative.value||n(AST_Undefined,e.alternative)}).transform(t)}).optimize(t);if(e.body instanceof AST_If&&!e.body.alternative&&!e.alternative&&(e=n(AST_If,e,{condition:n(AST_Binary,e.condition,{operator:"&&",left:e.condition,right:e.body.condition}),body:e.body.body,alternative:null})),b(e.body)&&e.alternative){var h=e.alternative;return e.alternative=null,n(AST_BlockStatement,e,{body:[e,h]}).optimize(t)}if(b(e.alternative)){var d=e.body;return e.body=e.alternative,e.condition=c?o:e.condition.negate(t),e.alternative=null,n(AST_BlockStatement,e,{body:[e,d]}).optimize(t)}return e}),e(AST_Switch,function(e,t){function S(e,r){r&&!b(r)?r.body=r.body.concat(e.body):p(t,e,s)}if(!t.option("switches"))return e;var r,a=e.expression.evaluate(t);if(a!==e.expression){var o=i(a,e.expression).transform(t);e.expression=v(o,e.expression)}if(!t.option("dead_code"))return e;for(var l,c,s=[],u=[],f=0,h=e.body.length;h>f&&!c;f++){if(r=e.body[f],r instanceof AST_Default)l?S(r,u[u.length-1]):l=r;else if(a!==e.expression){var d=r.expression.evaluate(t);if(d===a){if(c=r,l){var m=u.indexOf(l);u.splice(m,1),S(l,u[m-1]),l=null}}else if(d!==r.expression){S(r,u[u.length-1]);continue}}if(b(r)){var g=u[u.length-1];b(g)&&g.body.length==r.body.length&&n(AST_BlockStatement,g,g).equivalent_to(n(AST_BlockStatement,r,r))&&(g.body=[])}u.push(r)}for(;h>f;)S(e.body[f++],u[u.length-1]);for(u.length>0&&(u[0].body=s.concat(u[0].body)),e.body=u;r=u[u.length-1];){var y=r.body[r.body.length-1];if(y instanceof AST_Break&&t.loopcontrol_target(y)===e&&r.body.pop(),r.body.length||r instanceof AST_Case&&(l||r.expression.has_side_effects(t)))break;u.pop()===l&&(l=null)}if(0==u.length)return n(AST_BlockStatement,e,{body:s.concat(n(AST_SimpleStatement,e.expression,{body:e.expression}))}).optimize(t);if(1==u.length&&(u[0]===c||u[0]===l)){var w=!1,x=new TreeWalker(function(t){return w||t instanceof AST_Lambda||t instanceof AST_SimpleStatement?!0:void(t instanceof AST_Break&&x.loopcontrol_target(t)===e&&(w=!0))});if(e.walk(x),!w)return u=u[0].body.slice(),u.unshift(n(AST_SimpleStatement,e.expression,{body:e.expression})),n(AST_BlockStatement,e,{body:u}).optimize(t)}return e}),e(AST_Try,function(e,t){if(e.body=c(e.body,t),e.bcatch&&e.bfinally&&all(e.bfinally.body,s)&&(e.bfinally=null),all(e.body,s)){var r=[];return e.bcatch&&p(t,e.bcatch,r),e.bfinally&&(r=r.concat(e.bfinally.body)),n(AST_BlockStatement,e,{body:r}).optimize(t)}return e}),AST_Definitions.DEFMETHOD("remove_initializers",function(){this.definitions.forEach(function(e){e.value=null})}),AST_Definitions.DEFMETHOD("to_assignments",function(e){var t=e.option("reduce_vars"),r=this.definitions.reduce(function(e,r){if(r.value){var i=n(AST_SymbolRef,r.name,r.name);e.push(n(AST_Assign,r,{operator:"=",left:i,right:r.value})),t&&(i.definition().fixed=!1)}return e},[]);return 0==r.length?null:AST_Seq.from_array(r)}),e(AST_Definitions,function(e,t){return 0==e.definitions.length?n(AST_EmptyStatement,e):e}),e(AST_Call,function(e,t){var r=e.expression;if(t.option("reduce_vars")&&r instanceof AST_SymbolRef){var a=r.definition(),o=r.fixed_value();o instanceof AST_Defun&&(a.fixed=o=n(AST_Function,o,o).clone(!0)),o instanceof AST_Function&&(r=o,!t.option("unused")||1!=a.references.length||a.scope.uses_arguments&&a.orig[0]instanceof AST_SymbolFunarg||a.scope.uses_eval||t.find_parent(AST_Scope)!==a.scope||(e.expression=r))}if(t.option("unused")&&r instanceof AST_Function&&!r.uses_arguments&&!r.uses_eval){for(var u=0,c=0,f=0,p=e.args.length;p>f;f++){var h=f>=r.argnames.length;if(h||r.argnames[f].__unused){var d=e.args[f].drop_side_effect_free(t);if(d)e.args[u++]=d;else if(!h){e.args[u++]=n(AST_Number,e.args[f],{value:0});continue}}else e.args[u++]=e.args[f];c=u}e.args.length=c}if(t.option("unsafe"))if(r instanceof AST_SymbolRef&&r.undeclared())switch(r.name){case"Array":if(1!=e.args.length)return n(AST_Array,e,{elements:e.args}).optimize(t);break;case"Object":if(0==e.args.length)return n(AST_Object,e,{properties:[]});break;case"String":if(0==e.args.length)return n(AST_String,e,{value:""});if(e.args.length<=1)return n(AST_Binary,e,{left:e.args[0],operator:"+",right:n(AST_String,e,{value:""})}).optimize(t);break;case"Number":if(0==e.args.length)return n(AST_Number,e,{value:0});if(1==e.args.length)return n(AST_UnaryPrefix,e,{expression:e.args[0],operator:"+"}).optimize(t);case"Boolean":if(0==e.args.length)return n(AST_False,e);if(1==e.args.length)return n(AST_UnaryPrefix,e,{expression:n(AST_UnaryPrefix,e,{expression:e.args[0],operator:"!"}),operator:"!"}).optimize(t);break;case"Function":if(0==e.args.length)return n(AST_Function,e,{argnames:[],body:[]});if(all(e.args,function(e){return e instanceof AST_String}))try{var m="(function("+e.args.slice(0,-1).map(function(e){return e.value}).join(",")+"){"+e.args[e.args.length-1].value+"})()",v=parse(m);v.figure_out_scope({screw_ie8:t.option("screw_ie8")});var g=new Compressor(t.options);v=v.transform(g),v.figure_out_scope({screw_ie8:t.option("screw_ie8")}),v.mangle_names();var b;try{v.walk(new TreeWalker(function(e){if(e instanceof AST_Lambda)throw b=e,v}))}catch(w){if(w!==v)throw w}if(!b)return e;var x=b.argnames.map(function(t,r){return n(AST_String,e.args[r],{value:t.print_to_string()})}),m=OutputStream();return AST_BlockStatement.prototype._codegen.call(b,b,m),m=m.toString().replace(/^\{|\}$/g,""),x.push(n(AST_String,e.args[e.args.length-1],{value:m})),e.args=x,e}catch(w){if(!(w instanceof JS_Parse_Error))throw console.log(w),w;t.warn("Error parsing code passed to new Function [{file}:{line},{col}]",e.args[e.args.length-1].start),t.warn(w.toString())}}else{if(r instanceof AST_Dot&&"toString"==r.property&&0==e.args.length)return n(AST_Binary,e,{left:n(AST_String,e,{value:""}),operator:"+",right:r.expression}).optimize(t);if(r instanceof AST_Dot&&r.expression instanceof AST_Array&&"join"==r.property){var S;if(!(e.args.length>0&&(S=e.args[0].evaluate(t),S===e.args[0]))){var k=[],_=[];if(r.expression.elements.forEach(function(r){var i=r.evaluate(t);i!==r?_.push(i):(_.length>0&&(k.push(n(AST_String,e,{value:_.join(S)})),_.length=0),k.push(r))}),_.length>0&&k.push(n(AST_String,e,{value:_.join(S)})),0==k.length)return n(AST_String,e,{value:""});if(1==k.length)return k[0].is_string(t)?k[0]:n(AST_Binary,k[0],{operator:"+",left:n(AST_String,e,{value:""}),right:k[0]});if(""==S){var E;return E=k[0].is_string(t)||k[1].is_string(t)?k.shift():n(AST_String,e,{value:""}),k.reduce(function(e,t){return n(AST_Binary,t,{operator:"+",left:e,right:t})},E).optimize(t)}var d=e.clone();return d.expression=d.expression.clone(),d.expression.expression=d.expression.expression.clone(),d.expression.expression.elements=k,y(t,e,d)}}else if(r instanceof AST_Dot&&r.expression.is_string(t)&&"charAt"==r.property){var j=e.args[0],A=j?j.evaluate(t):0;if(A!==j)return n(AST_Sub,r,{expression:r.expression,property:i(0|A,j||r)}).optimize(t)}}if(r instanceof AST_Function){if(r.body[0]instanceof AST_Return){var q=r.body[0].value;if(!q||q.is_constant()){var x=e.args.concat(q||n(AST_Undefined,e));return AST_Seq.from_array(x).transform(t)}}if(t.option("side_effects")&&all(r.body,s)){var x=e.args.concat(n(AST_Undefined,e));return AST_Seq.from_array(x).transform(t)}}if(t.option("drop_console")&&r instanceof AST_PropAccess){for(var T=r.expression;T.expression;)T=T.expression;if(T instanceof AST_SymbolRef&&"console"==T.name&&T.undeclared())return n(AST_Undefined,e).optimize(t)}return t.option("negate_iife")&&t.parent()instanceof AST_SimpleStatement&&l(e)?e.negate(t,!0):e}),e(AST_New,function(e,t){if(t.option("unsafe")){var r=e.expression;if(r instanceof AST_SymbolRef&&r.undeclared())switch(r.name){case"Object":case"RegExp":case"Function":case"Error":case"Array":return n(AST_Call,e,e).transform(t)}}return e}),e(AST_Seq,function(e,r){if(!r.option("side_effects"))return e;if(e.car=e.car.drop_side_effect_free(r,first_in_statement(r)),!e.car)return a(r.parent(),e,e.cdr);if(r.option("cascade")){var i;if(e.car instanceof AST_Assign&&!e.car.left.has_side_effects(r)?i=e.car.left:e.car instanceof AST_Unary&&("++"==e.car.operator||"--"==e.car.operator)&&(i=e.car.expression),i&&!(i instanceof AST_SymbolRef&&(i.definition().orig[0]instanceof AST_SymbolLambda||t(i))))for(var o,s,u=e.cdr;;){if(u.equivalent_to(i)){var l=e.car instanceof AST_UnaryPostfix?n(AST_UnaryPrefix,e.car,{operator:e.car.operator,expression:i}):e.car;return o?(o[s]=l,e.cdr):l}if(u instanceof AST_Binary&&!(u instanceof AST_Assign))if(u.left.is_constant()){if("||"==u.operator||"&&"==u.operator)break;s="right"}else s="left";else{if(!(u instanceof AST_Call||u instanceof AST_Unary&&!d(u.operator)))break;s="expression"}o=u,u=u[s]}}return h(e.cdr,r)?n(AST_UnaryPrefix,e,{operator:"void",expression:e.car}):e}),AST_Unary.DEFMETHOD("lift_sequences",function(e){if(e.option("sequences")&&this.expression instanceof AST_Seq){var t=this.expression,r=t.to_array(),n=this.clone();return n.expression=r.pop(),r.push(n),t=AST_Seq.from_array(r).transform(e)}return this}),e(AST_UnaryPostfix,function(e,t){return e.lift_sequences(t)}),e(AST_UnaryPrefix,function(e,t){var r=e.expression;if("delete"==e.operator&&!(r instanceof AST_SymbolRef||r instanceof AST_PropAccess||r instanceof AST_NaN||r instanceof AST_Infinity||r instanceof AST_Undefined))return r instanceof AST_Seq?(r=r.to_array(),r.push(n(AST_True,e)),AST_Seq.from_array(r).optimize(t)):n(AST_Seq,e,{car:r,cdr:n(AST_True,e)}).optimize(t);var a=e.lift_sequences(t);if(a!==e)return a;if(t.option("side_effects")&&"void"==e.operator)return r=r.drop_side_effect_free(t),r?(e.expression=r,e):n(AST_Undefined,e).optimize(t);if(t.option("booleans")&&t.in_boolean_context())switch(e.operator){case"!":if(r instanceof AST_UnaryPrefix&&"!"==r.operator)return r.expression;r instanceof AST_Binary&&(e=y(t,e,r.negate(t,first_in_statement(t))));break;case"typeof":return t.warn("Boolean expression always true [{file}:{line},{col}]",e.start),(r instanceof AST_SymbolRef?n(AST_True,e):n(AST_Seq,e,{car:r,cdr:n(AST_True,e)})).optimize(t)}if("-"==e.operator&&r instanceof AST_Infinity&&(r=r.transform(t)),r instanceof AST_Binary&&("+"==e.operator||"-"==e.operator)&&("*"==r.operator||"/"==r.operator||"%"==r.operator))return n(AST_Binary,e,{operator:r.operator,left:n(AST_UnaryPrefix,r.left,{operator:e.operator,expression:r.left}),right:r.right});if("-"!=e.operator||!(r instanceof AST_Number||r instanceof AST_Infinity)){var o=e.evaluate(t);if(o!==e)return o=i(o,e).optimize(t),y(t,o,e)}return e}),AST_Binary.DEFMETHOD("lift_sequences",function(e){if(e.option("sequences")){if(this.left instanceof AST_Seq){var t=this.left,r=t.to_array(),n=this.clone();return n.left=r.pop(),r.push(n),AST_Seq.from_array(r).optimize(e)}if(this.right instanceof AST_Seq&&!this.left.has_side_effects(e)){for(var o,i="="==this.operator&&this.left instanceof AST_SymbolRef,a=this.right.clone(),t=a;(i||!t.car.has_side_effects(e))&&(o=t,t.cdr instanceof AST_Seq);)t=t.cdr=t.cdr.clone();if(o){var n=this.clone();return n.right=o.cdr,o.cdr=n,a.optimize(e)}}}return this});var x=makePredicate("== === != !== * & | ^");e(AST_Binary,function(e,t){function r(){return e.left.is_constant()||e.right.is_constant()||!e.left.has_side_effects(t)&&!e.right.has_side_effects(t)}function o(t){if(r()){t&&(e.operator=t);var n=e.left;e.left=e.right,e.right=n}}if(x(e.operator)&&e.right.is_constant()&&!e.left.is_constant()&&(e.left instanceof AST_Binary&&PRECEDENCE[e.left.operator]>=PRECEDENCE[e.operator]||o()),e=e.lift_sequences(t),t.option("comparisons"))switch(e.operator){case"===":case"!==":(e.left.is_string(t)&&e.right.is_string(t)||e.left.is_number(t)&&e.right.is_number(t)||e.left.is_boolean()&&e.right.is_boolean())&&(e.operator=e.operator.substr(0,2));case"==":case"!=":if(e.left instanceof AST_String&&"undefined"==e.left.value&&e.right instanceof AST_UnaryPrefix&&"typeof"==e.right.operator){var s=e.right.expression;(s instanceof AST_SymbolRef?s.undeclared():s instanceof AST_PropAccess&&!t.option("screw_ie8"))||(e.right=s,e.left=n(AST_Undefined,e.left).optimize(t),2==e.operator.length&&(e.operator+="="))}}if(t.option("booleans")&&"+"==e.operator&&t.in_boolean_context()){var u=e.left.evaluate(t),l=e.right.evaluate(t);if(u&&"string"==typeof u)return t.warn("+ in boolean context always true [{file}:{line},{col}]",e.start),n(AST_Seq,e,{car:e.right,cdr:n(AST_True,e)}).optimize(t);if(l&&"string"==typeof l)return t.warn("+ in boolean context always true [{file}:{line},{col}]",e.start),n(AST_Seq,e,{car:e.left,cdr:n(AST_True,e)}).optimize(t)}if(t.option("comparisons")&&e.is_boolean()){if(!(t.parent()instanceof AST_Binary)||t.parent()instanceof AST_Assign){var c=n(AST_UnaryPrefix,e,{operator:"!",expression:e.negate(t,first_in_statement(t))});e=y(t,e,c)}if(t.option("unsafe_comps"))switch(e.operator){case"<":o(">");break;case"<=":o(">=")}}if("+"==e.operator){if(e.right instanceof AST_String&&""==e.right.getValue()&&e.left.is_string(t))return e.left;if(e.left instanceof AST_String&&""==e.left.getValue()&&e.right.is_string(t))return e.right;if(e.left instanceof AST_Binary&&"+"==e.left.operator&&e.left.left instanceof AST_String&&""==e.left.left.getValue()&&e.right.is_string(t))return e.left=e.left.right,e.transform(t)}if(t.option("evaluate")){switch(e.operator){case"&&":var u=e.left.evaluate(t);if(!u)return t.warn("Condition left of && always false [{file}:{line},{col}]",e.start),a(t.parent(),e,e.left).optimize(t);if(u!==e.left)return t.warn("Condition left of && always true [{file}:{line},{col}]",e.start),a(t.parent(),e,e.right).optimize(t);if(t.option("booleans")&&t.in_boolean_context()){var l=e.right.evaluate(t);if(!l)return t.warn("Boolean && always false [{file}:{line},{col}]",e.start),n(AST_Seq,e,{car:e.left,cdr:n(AST_False,e)}).optimize(t);if(l!==e.right)return t.warn("Dropping side-effect-free && in boolean context [{file}:{line},{col}]",e.start),e.left.optimize(t)}break;case"||":var u=e.left.evaluate(t);if(!u)return t.warn("Condition left of || always false [{file}:{line},{col}]",e.start),a(t.parent(),e,e.right).optimize(t);if(u!==e.left)return t.warn("Condition left of || always true [{file}:{line},{col}]",e.start),a(t.parent(),e,e.left).optimize(t);if(t.option("booleans")&&t.in_boolean_context()){var l=e.right.evaluate(t);if(!l)return t.warn("Dropping side-effect-free || in boolean context [{file}:{line},{col}]",e.start),e.left.optimize(t);if(l!==e.right)return t.warn("Boolean || always true [{file}:{line},{col}]",e.start),n(AST_Seq,e,{car:e.left,cdr:n(AST_True,e)}).optimize(t)}}var f=!0;switch(e.operator){case"+":if(e.left instanceof AST_Constant&&e.right instanceof AST_Binary&&"+"==e.right.operator&&e.right.left instanceof AST_Constant&&e.right.is_string(t)&&(e=n(AST_Binary,e,{operator:"+",left:n(AST_String,e.left,{value:""+e.left.getValue()+e.right.left.getValue(),start:e.left.start,end:e.right.left.end}),right:e.right.right})),e.right instanceof AST_Constant&&e.left instanceof AST_Binary&&"+"==e.left.operator&&e.left.right instanceof AST_Constant&&e.left.is_string(t)&&(e=n(AST_Binary,e,{operator:"+",left:e.left.left,right:n(AST_String,e.right,{value:""+e.left.right.getValue()+e.right.getValue(),start:e.left.right.start,end:e.right.end})})),e.left instanceof AST_Binary&&"+"==e.left.operator&&e.left.is_string(t)&&e.left.right instanceof AST_Constant&&e.right instanceof AST_Binary&&"+"==e.right.operator&&e.right.left instanceof AST_Constant&&e.right.is_string(t)&&(e=n(AST_Binary,e,{operator:"+",left:n(AST_Binary,e.left,{operator:"+",left:e.left.left,right:n(AST_String,e.left.right,{value:""+e.left.right.getValue()+e.right.left.getValue(),start:e.left.right.start,end:e.right.left.end})}),right:e.right.right})),e.right instanceof AST_UnaryPrefix&&"-"==e.right.operator&&e.left.is_number(t)){e=n(AST_Binary,e,{operator:"-",left:e.left,right:e.right.expression});break}if(e.left instanceof AST_UnaryPrefix&&"-"==e.left.operator&&r()&&e.right.is_number(t)){e=n(AST_Binary,e,{operator:"-",left:e.right,right:e.left.expression});break}case"*":f=t.option("unsafe_math");case"&":case"|":case"^":if(e.left.is_number(t)&&e.right.is_number(t)&&r()&&!(e.left instanceof AST_Binary&&e.left.operator!=e.operator&&PRECEDENCE[e.left.operator]>=PRECEDENCE[e.operator])){var p=n(AST_Binary,e,{operator:e.operator,left:e.right,right:e.left});e=e.right instanceof AST_Constant&&!(e.left instanceof AST_Constant)?y(t,p,e):y(t,e,p)}f&&e.is_number(t)&&(e.right instanceof AST_Binary&&e.right.operator==e.operator&&(e=n(AST_Binary,e,{operator:e.operator,left:n(AST_Binary,e.left,{operator:e.operator,left:e.left,right:e.right.left,start:e.left.start,end:e.right.left.end}),right:e.right.right})),e.right instanceof AST_Constant&&e.left instanceof AST_Binary&&e.left.operator==e.operator&&(e.left.left instanceof AST_Constant?e=n(AST_Binary,e,{operator:e.operator,left:n(AST_Binary,e.left,{operator:e.operator,left:e.left.left,right:e.right,start:e.left.left.start,end:e.right.end}),right:e.left.right}):e.left.right instanceof AST_Constant&&(e=n(AST_Binary,e,{operator:e.operator,left:n(AST_Binary,e.left,{operator:e.operator,left:e.left.right,right:e.right,start:e.left.right.start,end:e.right.end}),right:e.left.left}))),e.left instanceof AST_Binary&&e.left.operator==e.operator&&e.left.right instanceof AST_Constant&&e.right instanceof AST_Binary&&e.right.operator==e.operator&&e.right.left instanceof AST_Constant&&(e=n(AST_Binary,e,{operator:e.operator,left:n(AST_Binary,e.left,{operator:e.operator,left:n(AST_Binary,e.left.left,{operator:e.operator,left:e.left.right,right:e.right.left,start:e.left.right.start,end:e.right.left.end}),right:e.left.left}),right:e.right.right})))}}if(e.right instanceof AST_Binary&&e.right.operator==e.operator&&("&&"==e.operator||"||"==e.operator||"+"==e.operator&&(e.right.left.is_string(t)||e.left.is_string(t)&&e.right.right.is_string(t))))return e.left=n(AST_Binary,e.left,{operator:e.operator,left:e.left,right:e.right.left}),e.right=e.right.right,e.transform(t);var h=e.evaluate(t);return h!==e?(h=i(h,e).optimize(t),y(t,h,e)):e}),e(AST_SymbolRef,function(e,t){function p(e){var t;return e.walk(new TreeWalker(function(e){return e instanceof AST_SymbolRef&&(t=!0),t?!0:void 0})),t}var r=e.resolve_defines(t);if(r)return r.optimize(t);if(t.option("screw_ie8")&&e.undeclared()&&(!e.scope.uses_with||!t.find_parent(AST_With)))switch(e.name){case"undefined":return n(AST_Undefined,e).optimize(t);case"NaN":return n(AST_NaN,e).optimize(t);case"Infinity":return n(AST_Infinity,e).optimize(t)}if(t.option("evaluate")&&t.option("reduce_vars")&&m(e,t.parent())!==e){var a=e.definition(),o=e.fixed_value();if(o){if(void 0===a.should_replace){var s=o.evaluate(t);if(s===o||!t.option("unsafe_regexp")&&s instanceof RegExp)a.should_replace=!1;else{s=i(s,o);var l,u=s.optimize(t).print_to_string().length;p(o)?l=function(){var e=s.optimize(t);return e===s?e.clone(!0):e}:(u=Math.min(u,o.print_to_string().length),l=function(){var e=v(s.optimize(t),o);return e===s||e===o?e.clone(!0):e});var c=a.name.length,f=0;!t.option("unused")||a.global&&!t.option("toplevel")||(f=(c+2+u)/a.references.length),a.should_replace=c+f>=u?l:!1}}if(a.should_replace)return a.should_replace()}}return e}),e(AST_Undefined,function(e,t){if(t.option("unsafe")){var i=r(t,"undefined");if(i){var a=n(AST_SymbolRef,e,{name:"undefined",scope:i.scope,thedef:i});return a.is_undefined=!0,a}}var o=m(t.self(),t.parent());return o&&S(o,e)?e:n(AST_UnaryPrefix,e,{operator:"void",expression:n(AST_Number,e,{value:0})})}),e(AST_Infinity,function(e,t){var i=m(t.self(),t.parent());return i&&S(i,e)?e:!t.option("keep_infinity")||i&&!S(i,e)||r(t,"Infinity")?n(AST_Binary,e,{operator:"/",left:n(AST_Number,e,{value:1}),right:n(AST_Number,e,{value:0})}):e}),e(AST_NaN,function(e,t){var i=m(t.self(),t.parent());return i&&!S(i,e)||r(t,"NaN")?n(AST_Binary,e,{operator:"/",left:n(AST_Number,e,{value:0}),right:n(AST_Number,e,{value:0})}):e});var k=["+","-","/","*","%",">>","<<",">>>","|","^","&"],_=["*","|","^","&"];e(AST_Assign,function(e,t){return e=e.lift_sequences(t),"="==e.operator&&e.left instanceof AST_SymbolRef&&e.right instanceof AST_Binary&&(e.right.left instanceof AST_SymbolRef&&e.right.left.name==e.left.name&&member(e.right.operator,k)?(e.operator=e.right.operator+"=",e.right=e.right.right):e.right.right instanceof AST_SymbolRef&&e.right.right.name==e.left.name&&member(e.right.operator,_)&&!e.right.left.has_side_effects(t)&&(e.operator=e.right.operator+"=",e.right=e.right.left)),e}),e(AST_Conditional,function(e,t){function c(e){return e.is_boolean()?e:n(AST_UnaryPrefix,e,{operator:"!",expression:e.negate(t)})}function f(e){return e instanceof AST_True||e instanceof AST_UnaryPrefix&&"!"==e.operator&&e.expression instanceof AST_Constant&&!e.expression.value}function p(e){return e instanceof AST_False||e instanceof AST_UnaryPrefix&&"!"==e.operator&&e.expression instanceof AST_Constant&&!!e.expression.value}if(!t.option("conditionals"))return e;if(e.condition instanceof AST_Seq){var r=e.condition.car;return e.condition=e.condition.cdr,AST_Seq.cons(r,e)}var i=e.condition.evaluate(t);if(i!==e.condition)return i?(t.warn("Condition always true [{file}:{line},{col}]",e.start),a(t.parent(),e,e.consequent)):(t.warn("Condition always false [{file}:{line},{col}]",e.start),
a(t.parent(),e,e.alternative));var o=i.negate(t,first_in_statement(t));y(t,i,o)===o&&(e=n(AST_Conditional,e,{condition:o,consequent:e.alternative,alternative:e.consequent}));var s=e.condition,u=e.consequent,l=e.alternative;return s instanceof AST_SymbolRef&&u instanceof AST_SymbolRef&&s.definition()===u.definition()?n(AST_Binary,e,{operator:"||",left:s,right:l}):u instanceof AST_Assign&&l instanceof AST_Assign&&u.operator==l.operator&&u.left.equivalent_to(l.left)&&(!e.condition.has_side_effects(t)||"="==u.operator&&!u.left.has_side_effects(t))?n(AST_Assign,e,{operator:u.operator,left:u.left,right:n(AST_Conditional,e,{condition:e.condition,consequent:u.right,alternative:l.right})}):u instanceof AST_Call&&l.TYPE===u.TYPE&&1==u.args.length&&1==l.args.length&&u.expression.equivalent_to(l.expression)&&!u.expression.has_side_effects(t)?(u.args[0]=n(AST_Conditional,e,{condition:e.condition,consequent:u.args[0],alternative:l.args[0]}),u):u instanceof AST_Conditional&&u.alternative.equivalent_to(l)?n(AST_Conditional,e,{condition:n(AST_Binary,e,{left:e.condition,operator:"&&",right:u.condition}),consequent:u.consequent,alternative:l}):u.equivalent_to(l)?n(AST_Seq,e,{car:e.condition,cdr:u}).optimize(t):f(e.consequent)?p(e.alternative)?c(e.condition):n(AST_Binary,e,{operator:"||",left:c(e.condition),right:e.alternative}):p(e.consequent)?f(e.alternative)?c(e.condition.negate(t)):n(AST_Binary,e,{operator:"&&",left:c(e.condition.negate(t)),right:e.alternative}):f(e.alternative)?n(AST_Binary,e,{operator:"||",left:c(e.condition.negate(t)),right:e.consequent}):p(e.alternative)?n(AST_Binary,e,{operator:"&&",left:c(e.condition),right:e.consequent}):e}),e(AST_Boolean,function(e,t){if(t.option("booleans")){var r=t.parent();return r instanceof AST_Binary&&("=="==r.operator||"!="==r.operator)?(t.warn("Non-strict equality against boolean: {operator} {value} [{file}:{line},{col}]",{operator:r.operator,value:e.value,file:r.start.file,line:r.start.line,col:r.start.col}),n(AST_Number,e,{value:+e.value})):n(AST_UnaryPrefix,e,{operator:"!",expression:n(AST_Number,e,{value:1-e.value})})}return e}),e(AST_Sub,function(e,t){var r=e.property;if(r instanceof AST_String&&t.option("properties")){if(r=r.getValue(),RESERVED_WORDS(r)?t.option("screw_ie8"):is_identifier_string(r))return n(AST_Dot,e,{expression:e.expression,property:r}).optimize(t);var a=parseFloat(r);isNaN(a)||a.toString()!=r||(e.property=n(AST_Number,e.property,{value:a}))}var o=e.evaluate(t);return o!==e?(o=i(o,e).optimize(t),y(t,o,e)):e}),e(AST_Dot,function(e,t){var r=e.resolve_defines(t);if(r)return r.optimize(t);var a=e.property;if(RESERVED_WORDS(a)&&!t.option("screw_ie8"))return n(AST_Sub,e,{expression:e.expression,property:n(AST_String,e,{value:a})}).optimize(t);if(t.option("unsafe_proto")&&e.expression instanceof AST_Dot&&"prototype"==e.expression.property){var o=e.expression.expression;if(o instanceof AST_SymbolRef&&o.undeclared())switch(o.name){case"Array":e.expression=n(AST_Array,e.expression,{elements:[]});break;case"Object":e.expression=n(AST_Object,e.expression,{properties:[]});break;case"String":e.expression=n(AST_String,e.expression,{value:""})}}var s=e.evaluate(t);return s!==e?(s=i(s,e).optimize(t),y(t,s,e)):e}),e(AST_Array,E),e(AST_Object,E),e(AST_RegExp,E),e(AST_Return,function(e,t){return e.value&&h(e.value,t)&&(e.value=null),e}),e(AST_VarDef,function(e,t){var r=t.option("global_defs");return r&&HOP(r,e.name.name)&&t.warn("global_defs "+e.name.name+" redefined [{file}:{line},{col}]",e.start),e})}();