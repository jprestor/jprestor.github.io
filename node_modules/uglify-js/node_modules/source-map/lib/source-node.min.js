function SourceNode(e,t,r,n,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==i?null:i,this[isSourceNode]=!0,null!=n&&this.add(n)}var SourceMapGenerator=require("./source-map-generator").SourceMapGenerator,util=require("./util"),REGEX_NEWLINE=/(\r?\n)/,NEWLINE_CODE=10,isSourceNode="$$$isSourceNode$$$";SourceNode.fromStringWithSourceMap=function(e,t,r){function c(e,t){if(null===e||void 0===e.source)n.add(t);else{var i=r?util.join(r,e.source):e.source;n.add(new SourceNode(e.originalLine,e.originalColumn,i,t,e.name))}}var n=new SourceNode,i=e.split(REGEX_NEWLINE),a=0,o=function(){function r(){return a<i.length?i[a++]:void 0}var e=r(),t=r()||"";return e+t},s=1,u=0,l=null;return t.eachMapping(function(e){if(null!==l){if(!(s<e.generatedLine)){var t=i[a],r=t.substr(0,e.generatedColumn-u);return i[a]=t.substr(e.generatedColumn-u),u=e.generatedColumn,c(l,r),void(l=e)}c(l,o()),s++,u=0}for(;s<e.generatedLine;)n.add(o()),s++;if(u<e.generatedColumn){var t=i[a];n.add(t.substr(0,e.generatedColumn)),i[a]=t.substr(e.generatedColumn),u=e.generatedColumn}l=e},this),a<i.length&&(l&&c(l,o()),n.add(i.splice(a).join(""))),t.sources.forEach(function(e){var i=t.sourceContentFor(e);null!=i&&(null!=r&&(e=util.join(r,e)),n.setSourceContent(e,i))}),n},SourceNode.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(!e[isSourceNode]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},SourceNode.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[isSourceNode]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},SourceNode.prototype.walk=function(e){for(var t,r=0,n=this.children.length;n>r;r++)t=this.children[r],t[isSourceNode]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},SourceNode.prototype.join=function(e){var t,r,n=this.children.length;if(n>0){for(t=[],r=0;n-1>r;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this},SourceNode.prototype.replaceRight=function(e,t){var r=this.children[this.children.length-1];return r[isSourceNode]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this},SourceNode.prototype.setSourceContent=function(e,t){this.sourceContents[util.toSetString(e)]=t},SourceNode.prototype.walkSourceContents=function(e){for(var t=0,r=this.children.length;r>t;t++)this.children[t][isSourceNode]&&this.children[t].walkSourceContents(e);for(var n=Object.keys(this.sourceContents),t=0,r=n.length;r>t;t++)e(util.fromSetString(n[t]),this.sourceContents[n[t]])},SourceNode.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},SourceNode.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},r=new SourceMapGenerator(e),n=!1,i=null,a=null,o=null,s=null;return this.walk(function(e,u){t.code+=e,null!==u.source&&null!==u.line&&null!==u.column?((i!==u.source||a!==u.line||o!==u.column||s!==u.name)&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:t.line,column:t.column},name:u.name}),i=u.source,a=u.line,o=u.column,s=u.name,n=!0):n&&(r.addMapping({generated:{line:t.line,column:t.column}}),i=null,n=!1);for(var l=0,c=e.length;c>l;l++)e.charCodeAt(l)===NEWLINE_CODE?(t.line++,t.column=0,l+1===c?(i=null,n=!1):n&&r.addMapping({source:u.source,original:{line:u.line,column:u.column},generated:{line:t.line,column:t.column},name:u.name})):t.column++}),this.walkSourceContents(function(e,t){r.setSourceContent(e,t)}),{code:t.code,map:r}},exports.SourceNode=SourceNode;