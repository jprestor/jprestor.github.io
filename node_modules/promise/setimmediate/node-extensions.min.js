"use strict";function denodeifyWithCount(e,t){for(var r=[],n=0;t>n;n++)r.push("a"+n);var i=["return function ("+r.join(",")+") {","var self = this;","return new Promise(function (rs, rj) {","var res = fn.call(",["self"].concat(r).concat([callbackFn]).join(","),");","if (res &&",'(typeof res === "object" || typeof res === "function") &&','typeof res.then === "function"',") {rs(res);}","});","};"].join("");return Function(["Promise","fn"],i)(Promise,e)}function denodeifyWithoutCount(e){for(var t=Math.max(e.length-1,3),r=[],n=0;t>n;n++)r.push("a"+n);var i=["return function ("+r.join(",")+") {","var self = this;","var args;","var argLength = arguments.length;","if (arguments.length > "+t+") {","args = new Array(arguments.length + 1);","for (var i = 0; i < arguments.length; i++) {","args[i] = arguments[i];","}","}","return new Promise(function (rs, rj) {","var cb = "+callbackFn+";","var res;","switch (argLength) {",r.concat(["extra"]).map(function(e,t){return"case "+t+":res = fn.call("+["self"].concat(r.slice(0,t)).concat("cb").join(",")+");break;"}).join(""),"default:","args[argLength] = cb;","res = fn.apply(self, args);","}","if (res &&",'(typeof res === "object" || typeof res === "function") &&','typeof res.then === "function"',") {rs(res);}","});","};"].join("");return Function(["Promise","fn"],i)(Promise,e)}var Promise=require("./core.js");module.exports=Promise,Promise.denodeify=function(e,t){return"number"==typeof t&&t!==1/0?denodeifyWithCount(e,t):denodeifyWithoutCount(e)};var callbackFn="function (err, res) {if (err) { rj(err); } else { rs(res); }}";Promise.nodeify=function(e){return function(){var t=Array.prototype.slice.call(arguments),r="function"==typeof t[t.length-1]?t.pop():null,n=this;try{return e.apply(this,arguments).nodeify(r,n)}catch(i){if(null===r||"undefined"==typeof r)return new Promise(function(e,t){t(i)});setImmediate(function(){r.call(n,i)})}}},Promise.prototype.nodeify=function(e,t){return"function"!=typeof e?this:void this.then(function(r){setImmediate(function(){e.call(t,null,r)})},function(r){setImmediate(function(){e.call(t,r)})})};