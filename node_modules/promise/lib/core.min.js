"use strict";function noop(){}function getThen(e){try{return e.then}catch(t){return LAST_ERROR=t,IS_ERROR}}function tryCallOne(e,t){try{return e(t)}catch(r){return LAST_ERROR=r,IS_ERROR}}function tryCallTwo(e,t,r){try{e(t,r)}catch(n){return LAST_ERROR=n,IS_ERROR}}function Promise(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("Promise constructor's argument is not a function");this._40=0,this._65=0,this._55=null,this._72=null,e!==noop&&doResolve(e,this)}function safeThen(e,t,r){return new e.constructor(function(n,i){var a=new Promise(noop);a.then(n,i),handle(e,new Handler(t,r,a))})}function handle(e,t){for(;3===e._65;)e=e._55;return Promise._37&&Promise._37(e),0===e._65?0===e._40?(e._40=1,void(e._72=t)):1===e._40?(e._40=2,void(e._72=[e._72,t])):void e._72.push(t):void handleResolved(e,t)}function handleResolved(e,t){asap(function(){var r=1===e._65?t.onFulfilled:t.onRejected;if(null===r)return void(1===e._65?resolve(t.promise,e._55):reject(t.promise,e._55));var n=tryCallOne(r,e._55);n===IS_ERROR?reject(t.promise,LAST_ERROR):resolve(t.promise,n)})}function resolve(e,t){if(t===e)return reject(e,new TypeError("A promise cannot be resolved with itself."));if(t&&("object"==typeof t||"function"==typeof t)){var r=getThen(t);if(r===IS_ERROR)return reject(e,LAST_ERROR);if(r===e.then&&t instanceof Promise)return e._65=3,e._55=t,void finale(e);if("function"==typeof r)return void doResolve(r.bind(t),e)}e._65=1,e._55=t,finale(e)}function reject(e,t){e._65=2,e._55=t,Promise._87&&Promise._87(e,t),finale(e)}function finale(e){if(1===e._40&&(handle(e,e._72),e._72=null),2===e._40){for(var t=0;t<e._72.length;t++)handle(e,e._72[t]);e._72=null}}function Handler(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function doResolve(e,t){var r=!1,n=tryCallTwo(e,function(e){r||(r=!0,resolve(t,e))},function(e){r||(r=!0,reject(t,e))});r||n!==IS_ERROR||(r=!0,reject(t,LAST_ERROR))}var asap=require("asap/raw"),LAST_ERROR=null,IS_ERROR={};module.exports=Promise,Promise._37=null,Promise._87=null,Promise._61=noop,Promise.prototype.then=function(e,t){if(this.constructor!==Promise)return safeThen(this,e,t);var r=new Promise(noop);return handle(this,new Handler(e,t,r)),r};